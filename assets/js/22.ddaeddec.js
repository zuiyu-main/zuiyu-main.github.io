(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{428:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("还是惯例，开头先放章节目录，如果有帮到你的地方，欢迎点赞关注转发，如有错误，欢迎指出，不胜感激")]),s._v(" "),n("p",[n("img",{attrs:{src:"Elasticsearch%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.assets%5Cimage-20230715120042657.png",alt:"image-20230715120042657"}})]),s._v(" "),n("h1",{attrs:{id:"一、环境初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、环境初始化"}},[s._v("#")]),s._v(" 一、环境初始化")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('version: \'3.8\'\nservices:\n  cerebro:\n    image: lmenezes/cerebro:0.8.3\n    container_name: cerebro\n    ports:\n     - "9000:9000"\n    command:\n     - -Dhosts.0.host=http://eshot:9200\n    networks:\n     - elastic\n  kibana:\n    image: docker.elastic.co/kibana/kibana:8.1.3\n    container_name: kibana\n    environment:\n      - I18N_LOCALE=zh-CN\n      - XPACK_GRAPH_ENABLED=true\n      - TIMELION_ENABLED=true\n      - XPACK_MONITORING_COLLECTION_ENABLED="true"\n      - ELASTICSEARCH_HOSTS=http://eshot:9200\n      - server.publicBaseUrl=http://192.168.160.234:5601\n    ports:\n      - "5601:5601"\n    networks:\n      - elastic\n  eshot:\n    image: elasticsearch:8.1.3\n    container_name: eshot\n    environment:\n      - node.name=eshot\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=hot\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    ports:\n      - 9200:9200\n    networks:\n      - elastic\n  eswarm:\n    image: elasticsearch:8.1.3\n    container_name: eswarm\n    environment:\n      - node.name=eswarm\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=warm\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n  escold:\n    image: elasticsearch:8.1.3\n    container_name: escold\n    environment:\n      - node.name=escold\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=cold\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n\n# volumes:\n#   eshotdata:\n#     driver: local\n#   eswarmdata:\n#     driver: local\n#   escolddata:\n#     driver: local\n\nnetworks:\n  elastic:\n    driver: bridge\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br")])]),n("h1",{attrs:{id:"二、测试数据添加"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、测试数据添加"}},[s._v("#")]),s._v(" 二、测试数据添加")]),s._v(" "),n("p",[s._v("创建测试索引")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /zfc-doc-000001\n{\n  "settings": {\n    "index":{\n      "number_of_shards":3,\n      "number_of_replicas":2\n    }\n  },\n  "mappings": {\n    "properties": {\n      "title":{\n        "type":"keyword"\n      },\n      "content":{\n        "type":"text"\n      },\n      "createTime":{\n        "type": "date",\n        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis" \n      },\n      "agreeNum":{\n        "type": "integer"\n      },\n      "comment":{\n        "type": "nested",\n        "properties": {\n          "content":{\n            "type":"text"\n          },\n          "name":{\n            "type":"keyword"\n          },\n          "time":{\n            "type":"date",\n            "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("h2",{attrs:{id:"_2-1、添加测试数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、添加测试数据"}},[s._v("#")]),s._v(" 2.1、添加测试数据")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT _bulk\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "1" } }\n{ "title" : "Java知识点大全","content":"java 泛型，基本类型有哪些","createTime": "2022-12-19","agreeNum":"99","comment":{"name":"张三","content":"学习java必备","time":"2022-12-19 09:00:00"} }\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "2" } }\n{ "title" : "MySQL必知必会","content":"mysql 索引、事务、锁","createTime": "2022-12-18","agreeNum":"500","comment":[{"name":"张三","content":"学习mysql通俗易懂","time":"2022-12-18 09:00:00"},{"name":"李四","content":"mysql 入门到精通必备的","time":"2022-12-18 10:00:00"}  ]}\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "3" } }\n{ "title" : "Redis运维实战","content":"redis的rdb与aof","createTime": "2022-12-18","agreeNum":"300","comment":[{"name":"小红","content":"redis的备份","time":"2022-12-18 09:00:00"},{"name":"李四","content": "redis 入门","time":"2022-12-18 15:00:00"}  ]}\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "4" } }\n{ "title" : "Elasticsearch","content":"ES crud","createTime": "2022-12-17","agreeNum":"300","comment":[{"name":"小红","content":"es的基础SQL语法","time":"2022-12-17 09:00:00"},{"name":"李四","content": "es 入门","time":"2022-12-18 16:00:00"}  ]}\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "5" } }\n{ "title" : "常见MQ知识点汇总","content":"rabbitmq kafka rockmq activemq","createTime": "2022-12-16","agreeNum":"260","comment":[{"name":"小红","content":"kafka的基础概念","time":"2022-12-18 09:00:00"},{"name":"李四","content": "事务消息","time":"2022-12-18 15:00:00"}  ]}\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "6" } }\n{ "title" : "ES奇淫技巧","content":"玩转es","createTime": "2022-12-18","agreeNum":"600","comment":[{"name":"小红1号","content":"es的基础SQL语法","time":"2022-12-17 09:00:00"},{"name":"李四1号","content": "es 入门","time":"2022-12-18 16:00:00"}  ]}\n{ "index" : { "_index" : "zfc-doc-000001", "_id" : "7" } }\n{ "title" : "ES","content":"真的666","createTime": "2022-12-17","agreeNum":"300","comment":[{"name":"小红1号","content":"es的基础SQL语法","time":"2022-12-17 09:00:00"},{"name":"李四1号","content": "es 入门","time":"2022-12-18 16:00:00"}  ]}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h1",{attrs:{id:"三、标准查询语句使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、标准查询语句使用"}},[s._v("#")]),s._v(" 三、标准查询语句使用")]),s._v(" "),n("p",[s._v("根据一个字段进行检索，假如我们要搜索"),n("code",[s._v("content")]),s._v("包含"),n("code",[s._v("ES")]),s._v("的文档，我们的查询语句可以这样写")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match":{\n      "content":"ES"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("上面这个语句的意思简单理解就是查询"),n("code",[s._v("content")]),s._v("字段中包含"),n("code",[s._v("ES")]),s._v("的文档。在深一层次来看，首先查看"),n("code",[s._v("content")]),s._v("字段的类型，通过查看上面的创建索引语句可以知道，"),n("code",[s._v("content")]),s._v("字段定义的是"),n("code",[s._v("text")]),s._v("类型，所以"),n("code",[s._v("Elasticsearch")]),s._v("会对"),n("code",[s._v("content")]),s._v("字段进行分词检索，返回文档中出现"),n("code",[s._v("es")]),s._v("的，除了上面这种写法外还可以使用如下几种方式进行检索")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 分词匹配es或者crud的文档\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "match":{\n      "content":"ES crud"\n    }\n  }\n}\n# 短语查询分词es\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "match_phrase":{\n      "content":"es"\n    }\n  }\n}\n# 前缀检索分词es\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "prefix":{\n      "content":"es"\n    }\n  }\n}\n# 模糊匹配分词es\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "fuzzy":{\n      "content":"es*"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("为了查询结果的更精确，增加"),n("code",[s._v("title")]),s._v("字段为"),n("code",[s._v("ES")]),s._v("的约束条件，需要注意大小写，因为"),n("code",[s._v("title")]),s._v("字段类型为"),n("code",[s._v("keyword")]),s._v("，不区分大小写的，所以查询语句可以这样写")]),s._v(" "),n("p",[s._v("该语句返回"),n("code",[s._v("content")]),s._v("字段中分词匹配词语"),n("code",[s._v("ES(不区分大小写)")]),s._v("的文档或者"),n("code",[s._v("title")]),s._v("字段精确匹配"),n("code",[s._v("ES")]),s._v("的文档")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "multi_match": {\n      "query": "ES",\n      "fields":["content","title"]\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("一个简单的检索语句通过上述几种方式即可实现了，但是实际工作中，肯定还是用到分词器的，下面就以常用的"),n("code",[s._v("IK分词器")]),s._v("进行说明")]),s._v(" "),n("h2",{attrs:{id:"_3-1、查询时指定分词器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、查询时指定分词器"}},[s._v("#")]),s._v(" 3.1、查询时指定分词器")]),s._v(" "),n("p",[s._v("首先是第一种查询时指定分词器的形式进行检索")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": {\n        "query": "es",\n        "analyzer": "ik_max_word"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("通过上面指定分词器的形式，我们在查询时就可以使用"),n("code",[s._v("ik_max_word")]),s._v("来作为检索分词来处理了，我们也可以在创建索引时增加字段分词的配置，方便检索时默认使用指定分词器检索，下面就是创建索引指定分词器的步骤")]),s._v(" "),n("h2",{attrs:{id:"_3-2、初始化默认分词器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、初始化默认分词器"}},[s._v("#")]),s._v(" 3.2、初始化默认分词器")]),s._v(" "),n("p",[s._v("1、删除刚才创建的索引")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("DELETE zfc-doc-000001\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("2、修改"),n("code",[s._v("content")]),s._v("字段，加入分词器"),n("code",[s._v("ik_max_word")]),s._v("，修改部分如下")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('      "content":{\n        "type":"text",\n        "analyzer": "ik_max_word"\n      }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("完整的语句如下所示")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /zfc-doc-000001\n{\n  "settings": {\n    "index":{\n      "number_of_shards":3,\n      "number_of_replicas":2\n    }\n  },\n  "mappings": {\n    "properties": {\n      "title":{\n        "type":"keyword"\n      },\n      "content":{\n        "type":"text",\n        "analyzer": "ik_max_word"\n      },\n      "createTime":{\n        "type": "date",\n        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis" \n      },\n      "agreeNum":{\n        "type": "integer"\n      },\n      "comment":{\n        "type": "nested",\n        "properties": {\n          "content":{\n            "type":"text"\n          },\n          "name":{\n            "type":"keyword"\n          },\n          "time":{\n            "type":"date",\n            "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"\n          }\n        }\n      }\n    }\n  }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("p",[s._v("通过上面语句创建完索引之后，"),n("code",[s._v("content")]),s._v("字段就是使用"),n("code",[s._v("ik_max_word")]),s._v("分词的了，这样使用普通的"),n("code",[s._v("match")]),s._v("查询即可，这里也就不再演示了")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match":{\n      "content":"es"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h1",{attrs:{id:"四、查询的进阶使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、查询的进阶使用"}},[s._v("#")]),s._v(" 四、查询的进阶使用")]),s._v(" "),n("h2",{attrs:{id:"_4-1、分页查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、分页查询"}},[s._v("#")]),s._v(" 4.1、分页查询")]),s._v(" "),n("p",[s._v("我们可以使用"),n("code",[s._v("from")]),s._v("和"),n("code",[s._v("size")]),s._v("参数配置使用，其中"),n("code",[s._v("from")]),s._v("为要跳过的文档数量，"),n("code",[s._v("size")]),s._v("为要返回的文档数量")]),s._v(" "),n("p",[s._v("在全部文档中，过滤前两个文件，从第"),n("strong",[s._v("3")]),s._v("个文档开始，返回"),n("strong",[s._v("10")]),s._v("个文档")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match_all": {\n    }\n  },\n  "size": 10,\n  "from": 2\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"_4-2、范围查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、范围查询"}},[s._v("#")]),s._v(" 4.2、范围查询")]),s._v(" "),n("p",[s._v("对于范围查询，我们可以使用"),n("code",[s._v("range")]),s._v("查询，最简单的参数就是"),n("code",[s._v("gte")]),s._v("与"),n("code",[s._v("lte")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "range": {\n      "agreeNum": {\n        "gte": 100,\n        "lte": 300\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"_4-3、聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3、聚合"}},[s._v("#")]),s._v(" 4.3、聚合")]),s._v(" "),n("p",[s._v("聚合语法的使用就是对一个文档中某个字段的统计，类似与关系型数据库中的先"),n("code",[s._v("group")]),s._v(" 在"),n("code",[s._v("count")]),s._v("一个字段的值，具体使用如下，如果我们不想返回都是哪些数据参与了聚合，还可以加入参数"),n("code",[s._v('"size":0')]),s._v("，如下语句中，其中"),n("code",[s._v("my_aggs")]),s._v("是自定义聚合的名称，"),n("code",[s._v("terms")]),s._v("是聚合的类型，"),n("code",[s._v("field")]),s._v("是要对哪个字段进行聚合，需要注意的是"),n("code",[s._v("text")]),s._v("类型是无法使用聚合的，"),n("code",[s._v("terms")]),s._v("下面的"),n("code",[s._v('"size":10')]),s._v("是指如果聚合桶的数量超过"),n("strong",[s._v("10")]),s._v("的话只取前10个")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "size": 0, \n  "aggs": {\n    "my_aggs": {\n      "terms": {\n        "field": "title",\n        "size": 10\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[n("code",[s._v("Elasticsearch")]),s._v("支持多种聚合类型，每种类型都有不同的功能和用途。以下是一些常用的聚合类型及其含义：")]),s._v(" "),n("ol",[n("li",[n("p",[n("strong",[s._v("Terms Aggregation（词条聚合）")]),s._v("：根据指定字段的值进行分组，并计算每个分组的文档数量。可以用于统计某个字段的分布情况。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Range Aggregation（范围聚合）")]),s._v("：将指定字段的值划分为不同的范围，并计算每个范围内的文档数量。可用于分析数值型字段的分布情况。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Date Histogram Aggregation（日期直方图聚合）")]),s._v("：根据指定日期字段的值进行分组，并按照时间间隔（如按月、按周）计算每个时间段内的文档数量。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Histogram Aggregation（直方图聚合）")]),s._v("：根据指定字段的值进行分组，并按照指定的间隔计算每个分组的文档数量。适用于分析数值型字段的分布情况。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Average Aggregation（平均值聚合）")]),s._v("：计算指定字段的平均值。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Sum Aggregation（求和聚合）")]),s._v("：计算指定字段的总和。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Min Aggregation（最小值聚合）")]),s._v("：计算指定字段的最小值。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Max Aggregation（最大值聚合）")]),s._v("：计算指定字段的最大值。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Cardinality Aggregation（基数聚合）")]),s._v("：计算指定字段的唯一值的数量。")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("Stats Aggregation（统计聚合）")]),s._v("：计算指定字段的统计信息，包括最小值、最大值、平均值、总和和文档数量。")])])]),s._v(" "),n("p",[s._v("这只是一小部分聚合类型的示例，"),n("code",[s._v("Elasticsearch")]),s._v("还提供了其他类型的聚合，如"),n("code",[s._v("Percentiles Aggregation")]),s._v("（百分位数聚合）、"),n("code",[s._v("Extended Stats Aggregation")]),s._v("（扩展统计聚合）等。你可以根据你的具体需求选择适合的聚合类型，并结合查询条件和其他聚合层级来进行复杂的数据分析和统计。")]),s._v(" "),n("blockquote",[n("p",[s._v("如果你看到这了，欢迎点个关注、后续推文深度只会越来越深，期待你的关注，让我们共同进步")])]),s._v(" "),n("p",[n("code",[s._v("elasticsearch")]),s._v("还支持嵌套聚合，只需要在"),n("code",[s._v("aggs")]),s._v("里面在写一个"),n("code",[s._v("aggs")]),s._v("即可，可以参考如下写法，"),n("strong",[s._v("对该示例不符合")]),s._v("，仅供参考")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /zfc-doc-000001/_search\n{\n  "size": 0,\n  "aggs": {\n    "my_aggs1": {\n      "terms": {\n        "field": "field1"\n      },\n      "aggs": {\n        "my_aggs2": {\n          "terms": {\n            "field": "field2"\n          },\n          "aggs": {\n            "avg_value": {\n              "avg": {\n                "field": "numeric_field"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h2",{attrs:{id:"_4-4、高亮结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4、高亮结果"}},[s._v("#")]),s._v(" 4.4、高亮结果")]),s._v(" "),n("p",[s._v("如果我们想在返回结果中对命中的关键词进行高亮显示可以使用如下语句")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": "ES"\n    }\n  },\n  "highlight": {\n    "fields": {\n      "content": {}\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("默认是在返回结果中加入"),n("code",[s._v("em")]),s._v("标签，如果我们想自定义标签可以使用如下语句，如下示例是改为了"),n("code",[s._v("strong")]),s._v("标签")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": "es"\n    }\n  },\n  "highlight": {\n    "pre_tags": ["&lt;strong>"],\n    "post_tags": ["&lt;/strong>"],\n    "fields": {\n      "content": {}\n    }\n  }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h1",{attrs:{id:"五、修改算分提升匹配度"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、修改算分提升匹配度"}},[s._v("#")]),s._v(" 五、修改算分提升匹配度")]),s._v(" "),n("h2",{attrs:{id:"_5-1、function-score"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1、function-score"}},[s._v("#")]),s._v(" 5.1、function_score")]),s._v(" "),n("p",[s._v("假设我们的原始查询语句如下")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": "es"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("返回结果如下，ID为"),n("strong",[s._v("6")]),s._v("的排在了第一位")]),s._v(" "),n("p",[n("img",{attrs:{src:"Elasticsearch%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.assets%5Cimage-20230715110507179.png",alt:"image-20230715110507179"}})]),s._v(" "),n("p",[s._v("如果我们想让ID为4的排在第一位如何修改查询语句呢，那么我们可以使用"),n("code",[s._v("function_score")]),s._v("来增加权重算分，比如使用"),n("code",[s._v("title")]),s._v("中匹配"),n("code",[s._v("Elasticsearch")]),s._v("的")]),s._v(" "),n("blockquote",[n("p",[s._v("此处是为举例，要学习思想，以后工作中才有更好的思路")])]),s._v(" "),n("p",[s._v("修改之后的查询语句如下")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "content": "es"\n        }\n      },\n      "functions": [\n        {\n          "filter": {\n            "term": {\n              "title": "Elasticsearch"\n            }\n          },\n        "weight":2\n        }\n      ],\n      "score_mode": "multiply",\n      "boost_mode": "multiply"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("可以看到，显示结果已经发生改变，ID为"),n("strong",[s._v("4")]),s._v("的算分已经高于ID为"),n("strong",[s._v("6")]),s._v("的算分了")]),s._v(" "),n("p",[n("img",{attrs:{src:"Elasticsearch%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.assets%5Cimage-20230715110826660.png",alt:"image-20230715110826660"}})]),s._v(" "),n("p",[s._v("其中，"),n("code",[s._v("query")]),s._v("参数用于指定正常的查询语句，"),n("code",[s._v("functions")]),s._v("参数用于定义一个或多个函数来修改文档得分")]),s._v(" "),n("p",[n("code",[s._v("score_mode")]),s._v("和"),n("code",[s._v("boost_mode")]),s._v("是用于控制"),n("code",[s._v("function_score")]),s._v("查询中如何计算文档得分和如何影响文档的排名的参数。")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("score_mode")]),s._v(":参数用于指定多个函数如何组合计算得分。它支持以下取值：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("multiply")]),s._v(": 将所有函数的得分相乘")]),s._v(" "),n("li",[n("code",[s._v("sum")]),s._v(": 将所有函数的得分相加")]),s._v(" "),n("li",[n("code",[s._v("avg")]),s._v(": 将所有函数的得分求平均值")]),s._v(" "),n("li",[n("code",[s._v("max")]),s._v(": 取所有函数的最大得分作为文档得分")]),s._v(" "),n("li",[n("code",[s._v("min")]),s._v(": 取所有函数的最小得分作为文档得分")]),s._v(" "),n("li",[n("code",[s._v("first")]),s._v(": 取第一个函数的得分作为文档得分")]),s._v(" "),n("li",[n("code",[s._v("weighted_sum")]),s._v(": 将所有函数的得分相加，并乘以给定的权重系数。")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("boost_mode")]),s._v("参数用于指定得分如何影响文档的排名。它支持以下取值：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("multiply")]),s._v(": 将得分与文档的原始得分相乘")]),s._v(" "),n("li",[n("code",[s._v("replace")]),s._v(": 使用得分替换文档的原始得分")]),s._v(" "),n("li",[n("code",[s._v("sum")]),s._v(": 将得分与文档的原始得分相加")]),s._v(" "),n("li",[n("code",[s._v("avg")]),s._v(": 将得分与文档的原始得分求平均值")]),s._v(" "),n("li",[n("code",[s._v("max")]),s._v(": 取得分和文档的原始得分的最大值作为文档得分")]),s._v(" "),n("li",[n("code",[s._v("min")]),s._v(": 取得分和文档的原始得分的最小值作为文档得分")])])])]),s._v(" "),n("p",[s._v("请注意，"),n("code",[s._v("score_mode")]),s._v("和"),n("code",[s._v("boost_mode")]),s._v("参数的取值会影响文档得分和排名的计算方式，需要根据具体的需求来选择合适的取值。另外，"),n("code",[s._v("function_score")]),s._v("查询中可以定义多个函数来修改文档得分，也可以使用"),n("code",[s._v("weight")]),s._v("函数来给定固定的分值，这些函数的组合和参数设置可能会对结果产生重要影响。")]),s._v(" "),n("p",[s._v("除了使用上述方式外，还可以使用如下几种方式进行算分的修改")]),s._v(" "),n("h2",{attrs:{id:"_5-2、boosting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2、boosting"}},[s._v("#")]),s._v(" 5.2、Boosting")]),s._v(" "),n("p",[s._v("如下是匹配"),n("code",[s._v("content")]),s._v("字段中包含"),n("code",[s._v("es")]),s._v("的，对"),n("code",[s._v("content")]),s._v("中包含"),n("code",[s._v("es")]),s._v("的进行减分")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "boosting": {\n      "positive": {\n        "term": {\n          "content": "es"\n        }\n      },\n      "negative": {\n        "term": {\n          "content": "玩转"\n        }\n      },\n      "negative_boost": 0.5\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"_5-3、field-value-factor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3、field-value-factor"}},[s._v("#")]),s._v(" 5.3、Field Value Factor")]),s._v(" "),n("blockquote",[n("p",[s._v("需要注意的是，"),n("code",[s._v("field_value_factor")]),s._v("函数用于根据字段的数值进行打分计算，要求字段是数值类型的。")])]),s._v(" "),n("p",[s._v("我们使用"),n("code",[s._v("Field Value Factor")]),s._v("来根据字段"),n("code",[s._v("agreeNum")]),s._v("的值对包含"),n("code",[s._v("ES")]),s._v("关键词的文档进行加权。使用"),n("code",[s._v("log1p")]),s._v("修饰符可以将字段值的对数应用于计算")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": "ES"\n    }\n  },\n  "sort": [\n    {\n      "_score": {\n        "order": "desc"\n      }\n    }\n  ]\n}\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "content": "ES"\n        }\n      },\n      "field_value_factor": {\n        "field": "agreeNum",\n        "factor": 0.1,\n        "modifier": "log1p"\n      }\n    }\n  },\n  "sort": [\n    {\n      "_score": {\n        "order": "asc"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("p",[s._v("其中"),n("code",[s._v("field_value_factor")]),s._v("的参数含义如下")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("field")]),s._v(": 要计算得分的字段名")]),s._v(" "),n("li",[n("code",[s._v("factor")]),s._v(": 一个乘数，用于缩放字段值的影响。可以使用任何非负数值。假如"),n("code",[s._v("factor")]),s._v("的值是"),n("strong",[s._v("0.1")]),s._v("，表示字段值的影响将会被减小")]),s._v(" "),n("li",[n("code",[s._v("modifier")]),s._v(": 一个修饰符，用于对数值进行修改以调整得分\n"),n("ul",[n("li",[n("code",[s._v("none")]),s._v("：不应用任何修饰符，默认情况下为1")]),s._v(" "),n("li",[n("code",[s._v("log")]),s._v("：对计算结果取对数，以减少较大值的影响")]),s._v(" "),n("li",[n("code",[s._v("log1p")]),s._v("：与"),n("code",[s._v("log")]),s._v("类似，但在计算结果前先加1，可以避免对0值进行对数运算")])])])]),s._v(" "),n("h2",{attrs:{id:"_5-4、script-score"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-4、script-score"}},[s._v("#")]),s._v(" 5.4、Script Score")]),s._v(" "),n("p",[s._v("我们可以使用"),n("code",[s._v("script_score")]),s._v("来自定义计算得分，此处仅为示例，具体可以根据自己的业务来修改。具体计算分可以通过"),n("code",[s._v("explain")]),s._v("来查看验证")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "explain": true, \n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "content": "es"\n        }\n      },\n      "script_score": {\n        "script": {\n          "source": "Math.log(doc[\'agreeNum\'].value + 10)"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"_5-5、decay-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-5、decay-functions"}},[s._v("#")]),s._v(" 5.5、Decay Functions")]),s._v(" "),n("p",[s._v("我们使用Gauss衰减函数根据字段"),n("code",[s._v("createTime")]),s._v("的值来衰减文档的得分。在这个例子中，以"),n("code",[s._v("2022-12-01")]),s._v("为中心，每过"),n("code",[s._v("10")]),s._v("天，得分将衰减一半。参考结果可以使用下面两个查询语句对应")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET zfc-doc-000001/_search\n{\n  "query": {\n    "match": {\n      "content": "es"\n    }\n  }\n}\n\nGET zfc-doc-000001/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "content": "es"\n        }\n      },\n      "functions": [\n        {\n          "gauss": {\n            "createTime": {\n              "origin": "2022-12-01",\n              "scale": "10d"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("h1",{attrs:{id:"六、filter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、filter"}},[s._v("#")]),s._v(" 六、Filter")]),s._v(" "),n("p",[n("code",[s._v("Filter")]),s._v("和"),n("code",[s._v("Query")]),s._v("是"),n("code",[s._v("Elasticsearch")]),s._v("中用于检索和过滤数据的两种不同方式，它们各自有一些优缺点")]),s._v(" "),n("p",[n("strong",[s._v("Filter的优点：")])]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("性能更高")]),s._v("：Filter对结果进行缓存，可以重复使用缓存结果，提高查询的性能。当使用相同的过滤条件进行多次查询时，Filter可以避免重复计算")]),s._v(" "),n("li",[n("strong",[s._v("精确性更高")]),s._v("：Filter对结果进行精确匹配，只返回满足过滤条件的文档，不计算相关性得分。这使得Filter非常适用于那些不需要考虑相关性的精确匹配查询")]),s._v(" "),n("li",[n("strong",[s._v("可缓存性")]),s._v("：Filter的结果可以被缓存，可以在后续的查询中重复使用。如果数据没有变化，那么缓存的结果可以直接返回，减少了计算的开销")])]),s._v(" "),n("p",[n("strong",[s._v("Filter的缺点：")])]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("无法计算相关性得分")]),s._v("：Filter不计算相关性得分，因此无法进行排序或评分。如果需要根据文档的相关性进行排序或评分，就需要使用Query")]),s._v(" "),n("li",[n("strong",[s._v("不支持全文搜索")]),s._v("：Filter只能进行精确匹配，无法进行全文搜索。如果需要进行全文搜索，就需要使用Query")])]),s._v(" "),n("p",[n("strong",[s._v("Query的优点：")])]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("支持全文搜索")]),s._v("：Query可以进行全文搜索，可以对文本进行分词和相关性评分，返回与查询条件最匹配的文档")]),s._v(" "),n("li",[n("strong",[s._v("支持排序和评分")]),s._v("：Query可以根据文档的相关性得分进行排序和评分，使得搜索结果更具有相关性")]),s._v(" "),n("li",[n("strong",[s._v("灵活性更高")]),s._v("：Query提供了更多的查询选项和查询语法，可以进行复杂的查询操作，包括布尔逻辑、范围查询、模糊查询等")])]),s._v(" "),n("p",[n("strong",[s._v("Query的缺点：")])]),s._v(" "),n("ol",[n("li",[n("strong",[s._v("性能相对较低")]),s._v("：Query需要计算相关性得分，并对所有文档进行评分和排序，因此相对于Filter而言，性能较低")]),s._v(" "),n("li",[n("strong",[s._v("无法缓存结果")]),s._v("：由于Query计算的是相关性得分，结果会随着数据的变化而变化，无法进行缓存和重复使用")])]),s._v(" "),n("p",[s._v("综上所述，Filter适用于需要精确匹配和高性能的查询场景，而Query适用于需要全文搜索、排序和评分的场景。根据具体的需求和性能要求，选择合适的过滤方式可以提高查询的效率和准确性")]),s._v(" "),n("h1",{attrs:{id:"补充"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[s._v("#")]),s._v(" 补充")]),s._v(" "),n("p",[n("code",[s._v("Elasticsearch")]),s._v("的查询"),n("code",[s._v("DSL")]),s._v("语句中有很多常用的参数，用于指定查询的条件和行为。以下是一些常用的查询：")]),s._v(" "),n("ol",[n("li",[n("code",[s._v("match")]),s._v(": 使用"),n("code",[s._v("match")]),s._v("查询参数可以执行全文本搜索，它会将查询字符串分析为词项并与文档进行匹配")]),s._v(" "),n("li",[n("code",[s._v("term")]),s._v(": "),n("code",[s._v("term")]),s._v("查询参数用于精确匹配某个字段的值，不进行分析")]),s._v(" "),n("li",[n("code",[s._v("bool")]),s._v(": "),n("code",[s._v("bool")]),s._v("查询参数用于组合多个查询条件，如"),n("code",[s._v("must")]),s._v("（与操作）、"),n("code",[s._v("should")]),s._v("（或操作）、"),n("code",[s._v("must_not")]),s._v("（非操作）")]),s._v(" "),n("li",[n("code",[s._v("range")]),s._v(": "),n("code",[s._v("range")]),s._v("查询参数用于匹配指定范围内的值，可以用于数值、日期等类型的字段")]),s._v(" "),n("li",[n("code",[s._v("exists")]),s._v(": "),n("code",[s._v("exists")]),s._v("查询参数用于匹配包含指定字段的文档")]),s._v(" "),n("li",[n("code",[s._v("prefix")]),s._v(": "),n("code",[s._v("prefix")]),s._v("查询参数用于匹配以指定前缀开头的字段值")]),s._v(" "),n("li",[n("code",[s._v("wildcard")]),s._v(":"),n("code",[s._v("wildcard")]),s._v("查询参数用于支持通配符匹配，如使用"),n("code",[s._v("*")]),s._v("和"),n("code",[s._v("?")]),s._v("进行模糊匹配")]),s._v(" "),n("li",[n("code",[s._v("fuzzy")]),s._v(": "),n("code",[s._v("fuzzy")]),s._v("查询参数用于执行模糊匹配，可以处理拼写错误或相似度较高的查询字符串")]),s._v(" "),n("li",[n("code",[s._v("match_phrase")]),s._v(": "),n("code",[s._v("match_phrase")]),s._v("查询参数用于匹配包含指定短语的文档")]),s._v(" "),n("li",[n("code",[s._v("multi_match")]),s._v(": "),n("code",[s._v("multi_match")]),s._v("查询参数用于在多个字段中执行全文本搜索")]),s._v(" "),n("li",[n("code",[s._v("terms")]),s._v(":"),n("code",[s._v("terms")]),s._v("查询是一种多词项查询，用于查找包含给定词项中任何一个的文档")]),s._v(" "),n("li",[n("code",[s._v("match_phrase_prefix")]),s._v(":"),n("code",[s._v("match_phrase_prefix")]),s._v("查找包含指定短语前缀的文档。它可以通过指定一个短语前缀和一个最大扩展长度来实现")]),s._v(" "),n("li",[n("code",[s._v("regexp")]),s._v(":"),n("code",[s._v("regexp")]),s._v("是使用正则表达式匹配文档的，能够在文本字段中匹配符合正则表达式的文本，从而检索文档")])])])}),[],!1,null,null,null);n.default=t.exports}}]);