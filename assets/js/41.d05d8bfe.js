(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{449:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("hr"),s._v(" "),e("p",[s._v("title: Elasticsearch 数据备份与还原\ndate: 2019-01-01\ntags:")]),s._v(" "),e("ul",[e("li",[s._v("Elasticsearch\ncategories:")]),s._v(" "),e("li",[s._v("Elasticsearch")])]),s._v(" "),e("hr"),s._v(" "),e("h1",{attrs:{id:"elasticsearch-6-5-操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-6-5-操作"}},[s._v("#")]),s._v(" elasticsearch 6.5 操作")]),s._v(" "),e("h2",{attrs:{id:"elasticsearch-快照还原"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-快照还原"}},[s._v("#")]),s._v(" elasticsearch 快照还原")]),s._v(" "),e("ul",[e("li",[s._v("创建一个测试索引")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\ncurl -X PUT "d.xiangyunkj.com:8214/my_index?pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "mappings": {\n    "_doc": { \n      "properties": { \n        "title":    { "type": "text"  }, \n        "name":     { "type": "text"  }, \n        "age":      { "type": "integer" },  \n        "created":  {\n          "type":   "date", \n          "format": "strict_date_optional_time||epoch_millis"\n        }\n      }\n    }\n  }\n}\n\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("ul",[e("li",[s._v("创建快照")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\ncurl -X PUT "d.xiangyunkj.com:8214/_snapshot/my_index?pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "type": "fs",\n  "settings": {\n    "location": "my_index_location"\n  }\n}\n\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("创建指定索引的快照")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X PUT "d.xiangyunkj.com:8214/_snapshot/my_index/snapshot_1?wait_for_completion=true&amp;pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "indices": "note_file,note_deal_logger",\n  "ignore_unavailable": true,\n  "include_global_state": false\n}\n\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[s._v("导出带日期的快照")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X PUT "d.xiangyunkj.com:8214/_snapshot/my_index/%3Csnapshot-%7Bnow%2Fd%7D%3E?pretty"\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("读取带日期的快照")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X GET "d.xiangyunkj.com:8214/_snapshot/my_index/snapshot-2020.06.22?pretty"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("还原所有索引的快照")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X POST "d.xiangyunkj.com:8214/_snapshot/my_index/snapshot-2020.06.22/_restore?pretty"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("恢复指定索引的快照")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X POST "d.xiangyunkj.com:8214/_snapshot/my_index/snapshot_2/_restore?pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "indices": "my_index",\n  "ignore_unavailable": true,\n  "include_global_state": true,\n  "rename_pattern": "index_(.+)",\n  "rename_replacement": "restored_index_$1"\n}\n\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("设置demo 数据")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X POST "d.xiangyunkj.com:8214/_bulk?pretty" -H \'Content-Type: application/json\' -d\'\n{ "index" : { "_index" : "my_index", "_type" : "_doc", "_id" : "1" } }\n{ "title" : "标题1", "name":"name1","age":"1"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "2" } }\n{ "title" : "标题2", "name":"name2","age":"2"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "3" } }\n{ "title" : "标题3", "name":"name3","age":"3"}\n\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("读取数据")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X GET "d.xiangyunkj.com:8214/my_index/_doc/1?pretty"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("删除数据")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('curl -X DELETE "d.xiangyunkj.com:8214/my_index/_doc/1?pretty"\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"elasticsearch-数据备份还原-参考203-home-xykj-micro-service-elasticsearch-elasticsearch-dump"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-数据备份还原-参考203-home-xykj-micro-service-elasticsearch-elasticsearch-dump"}},[s._v("#")]),s._v(" elasticsearch 数据备份还原,参考203 /home/xykj/micro-service/elasticsearch/elasticsearch-dump")]),s._v(" "),e("ul",[e("li",[s._v("备份")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sp=$(cd `dirname $0`; pwd)\ndocker run --rm -ti -v $sp/data:/tmp elasticdump/elasticsearch-dump \\\n  --input=http://d.xiangyunkj.com:8214/note_file \\\n  --output=/tmp/note_file_mapping.json \\\n  --type=data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("还原")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  docker run --rm -ti -v $PWD/data:/tmp elasticdump/elasticsearch-dump \\\n--input=/tmp/note_file_mapping.json \\\n--output=http://d.xiangyunkj.com:8214/note_file_bak \\\n--type=data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])])])])}),[],!1,null,null,null);e.default=t.exports}}]);