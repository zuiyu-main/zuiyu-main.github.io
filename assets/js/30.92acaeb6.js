(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{438:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("最近因为工作原因吗，比较忙，然后个人也比较懒，输出又慢下来了，后面会慢慢恢复的，定期保证周更吧，并且保证质量输出。")]),s._v(" "),n("p",[s._v("阅读本文需要一定的"),n("code",[s._v("Elasticsearch")]),s._v("基础哦，本文深度有，但是不深")]),s._v(" "),n("h1",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),n("p",[s._v("Elasticsearch中"),n("code",[s._v("Join")]),s._v("数据类型的字段相信大家也都用过，也就是口中常谈的父子文档。在Elasticsearch中"),n("code",[s._v("Join")]),s._v("不能跨索引和分片，所以保存文档信息时要保证父子文档使用"),n("strong",[s._v("相同的路由参数")]),s._v("来保证父文档与子文档保存在同一个索引的同一个分片，那么都有哪些限制呢？")]),s._v(" "),n("h1",{attrs:{id:"父子关系的限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#父子关系的限制"}},[s._v("#")]),s._v(" 父子关系的限制")]),s._v(" "),n("ul",[n("li",[s._v("每个索引中只能有一个关系字段")]),s._v(" "),n("li",[s._v("父文档与子文档必须在同一个索引分片中，所以我们在对父子文档增加、删除、修改时要设置路由值，保证数据都在同一分片")]),s._v(" "),n("li",[s._v("一个父文档可以包含多个子文档，但是一个子文档只能有一个父文档")]),s._v(" "),n("li",[s._v("只能在"),n("code",[s._v("Join")]),s._v("类型的字段上建立关系")]),s._v(" "),n("li",[s._v("在保证当前文档是父文档的前提下可以增加子文档")])]),s._v(" "),n("h1",{attrs:{id:"global-ordinals"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#global-ordinals"}},[s._v("#")]),s._v(" Global ordinals")]),s._v(" "),n("p",[s._v("翻译过来就是全局序数。什么是全局序数呢，官方文档中说明了，这就是一个加速查询的一个东西，使用了全局序数之后可以让数据更紧凑；详细的就不展开了，后面有机会再详细说明一下全局序数，具体的目前可以查看一下官方文档")]),s._v(" "),n("p",[s._v("对于我们本章节内容来说，我们知道父子文档"),n("code",[s._v("Join")]),s._v("类型是使用全局序数来加速查询的就可以了。默认情况下，全局序数基本是实时构建的，当索引发生变化，全局序数会重新构建。这个过程会增加"),n("code",[s._v("refresh")]),s._v("的时间，当然这个配置也是可以关闭的，但是关闭之后会在我们接下来遇到的第一个父连接或者聚合的查询时重新构建全局序数，这样这一部分的时间就反馈给了用户，官方也是不建议我们这样做的，感觉对用户来说不是那么的友好，主要还是在一个权衡。最坏的情况就是同时有多个写入，也就是同时有多个全局序数需要重新构建，也就会造成在单个"),n("code",[s._v("refresh")]),s._v("的时间间隔内要重新构建多个全局序数")]),s._v(" "),n("p",[s._v("当然如果关联字段使用的不是很频繁并且写入事件很多，禁用掉是值得推荐的，禁用方式如下")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "join_field": {\n        "type": "join",\n        "relations": {\n           "goods": ["details","evaluate"],\n           "evaluate":"vote"\n        },\n        "eager_global_ordinals": false\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("当然，对于全局序数占用的堆大小情况可以使用如下语句查看")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# Per-index\nGET my-index-000001/_stats/fielddata?human&amp;fields=join_field#goods\n\n# Per-node per-index\nGET _nodes/stats/indices/fielddata?human&amp;fields=join_field#goods\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h1",{attrs:{id:"父子文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#父子文档"}},[s._v("#")]),s._v(" 父子文档")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("首先我们还是创建一个正常的父子关系索引，"),n("strong",[s._v("商品")]),s._v("作为父文档，"),n("strong",[s._v("详情")]),s._v("作为子文档")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "id": {\n        "type": "keyword"\n      },\n      "join_field": { \n        "type": "join",\n        "relations": {\n          "goods": "details" \n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("my-index-000001")]),s._v("：索引名称")]),s._v(" "),n("li",[n("strong",[s._v("id")]),s._v("：文档主键")]),s._v(" "),n("li",[n("strong",[s._v("join_field")]),s._v("：父子关系字段，"),n("code",[s._v("type")]),s._v("标记为"),n("code",[s._v("Join")]),s._v("为父子文档")]),s._v(" "),n("li",[n("strong",[s._v("relations")]),s._v(":  定义父子关系，"),n("code",[s._v("goods")]),s._v("为父文档类型名称，"),n("code",[s._v("details")]),s._v("为子文档类型名称，后面插入数据，查询都会使用")])])]),s._v(" "),n("li",[n("p",[s._v("插入几条测试数据，商品有"),n("strong",[s._v("iphon")]),s._v("和"),n("strong",[s._v("mac")]),s._v("，详情为颜色外观与内存配置等")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my-index-000001/_doc/1?refresh\n{\n  "id": "1",\n  "text": "iphone 14 pro max",\n  "join_field": {\n    "name": "goods" \n  }\n}\n\nPUT my-index-000001/_doc/2?refresh\n{\n  "id": "2",\n  "text": "macbook pro ",\n  "join_field": {\n    "name": "goods"\n  }\n}\n\nPUT my-index-000001/_doc/3?routing=1&amp;refresh \n{\n  "id": "3",\n  "text": "512G 16核",\n  "join_field": {\n    "name": "details", \n    "parent": "1" \n  }\n}\n\nPUT my-index-000001/_doc/4?routing=1&amp;refresh\n{\n  "id": "4",\n  "text": "粉/银/黑/抹茶绿",\n  "join_field": {\n    "name": "details",\n    "parent": "1"\n  }\n}\nPUT my-index-000001/_doc/5?routing=1&amp;refresh \n{\n  "id": "5",\n  "text": "1T 32G",\n  "join_field": {\n    "name": "details", \n    "parent": "2" \n  }\n}\n\nPUT my-index-000001/_doc/6?routing=1&amp;refresh\n{\n  "id": "6",\n  "text": "银/黑",\n  "join_field": {\n    "name": "details",\n    "parent": "2"\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用"),n("code",[s._v("parent_id")]),s._v("查询父子文档，以上面插入的测试数据查询，查找"),n("code",[s._v("mac")]),s._v("的详情信息语句如下，前提是知道父文档的"),n("code",[s._v("id")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET my-index-000001/_search\n{\n  "query": {\n    "parent_id": {\n      "type": "details",\n      "id":"2"\n    }\n  },\n  "sort":["id"]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("大部分情况上面是不能满足我们的查询请求的，所以我们还可以使用"),n("code",[s._v("has_parent")]),s._v("或者"),n("code",[s._v("has_child")]),s._v("查询")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("使用"),n("code",[s._v("has_parent")]),s._v("查询：父文档"),n("code",[s._v("goods")]),s._v("中所有包含"),n("code",[s._v("macbook")]),s._v("的子文档（后文的孙子文档也可以查询）")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET my-index-000001/_search\n{\n  "query": {\n    "has_parent": {\n      "parent_type": "goods",\n      "query": {\n        "match": {\n          "text": "macbook"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用"),n("code",[s._v("hash_child")]),s._v("查看"),n("code",[s._v("details")]),s._v("子文档中有"),n("code",[s._v("1T")]),s._v("关键字的所有父文档")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET my-index-000001/_search\n{\n  "query": {\n    "has_child": {\n      "type": "details",\n      "query": {\n        "match": {\n          "text": "1T"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])])])]),s._v(" "),n("li",[n("p",[s._v("使用"),n("code",[s._v("parent-join")]),s._v("查询或者聚合")]),s._v(" "),n("p",[n("code",[s._v("Elasticsearch")]),s._v("在使用"),n("code",[s._v("Join")]),s._v("类型数据类型时，会自动创建一个附加的字段，结构为"),n("code",[s._v("Join")]),s._v("的字段名加"),n("code",[s._v("#号")]),s._v("加父类型，以上文为例，创建一个附加字段("),n("code",[s._v("join_field#goods")]),s._v(")，如下是使用"),n("code",[s._v("parent-join")]),s._v("字段查询聚合的一个例子，参考自官网，应用了"),n("code",[s._v("8.1版本")]),s._v("的新特性"),n("strong",[s._v("运行时字段")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET my-index-000001/_search\n{\n  "query": {\n    "parent_id": { \n      "type": "details",\n      "id": "1"\n    }\n  },\n  "aggs": {\n    "parents": {\n      "terms": {\n        "field": "join_field#goods", \n        "size": 10\n      }\n    }\n  },\n  "runtime_mappings": {\n    "my_parent_field": {\n      "type": "long",\n      "script": """\n        emit(Integer.parseInt(doc[\'join_field#goods\'].value)) \n      """\n    }\n  },\n  "fields": [\n    { "field": "my_parent_field" }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("Join")]),s._v("类型的父子文档，上面我们演示了一个父文档对应一种子文档类型的例子，"),n("code",[s._v("Join")]),s._v("类型也支持一个父类型有多个子类型，以上文为基础，加入下面语句测试")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "id": {\n        "type": "keyword"\n      },\n      "join_field": { \n        "type": "join",\n        "relations": {\n          "goods": ["details","evaluate"] \n        }\n      }\n    }\n  }\n}\nPUT my-index-000001/_doc/7?routing=1&amp;refresh\n{\n  "id": "7",\n  "text": "运行流程，无卡顿，待机时间长",\n  "join_field": {\n    "name": "evaluate",\n    "parent": "1"\n  }\n}\nPUT my-index-000001/_doc/8?routing=1&amp;refresh\n{\n  "id": "8",\n  "text": "体重轻，携带方便，编码利器",\n  "join_field": {\n    "name": "evaluate",\n    "parent": "2"\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("同样的，细心的同学已经看到了，上文已经标记了孙子文档，对的，你没看错就是孙子文档，三级的层级，级别可以更深，但是"),n("code",[s._v("Elasticsearch")]),s._v("不建议很深的层次，毕竟"),n("code",[s._v("Join")]),s._v("很消耗性能的，层级再深点没法用了,下面就是多级别的语句测试，此时他们三者的关系就如下所示")]),s._v(" "),n("p",[n("img",{attrs:{src:"Join%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E8%B6%85%E5%AE%B9%E6%98%93%E4%B8%8A%E6%89%8B%E7%9A%84%E5%A5%BD%E5%90%A7(Elasticsearch).assets/image-20220915232907370.png",alt:"image-20220915232907370"}})]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "id": {\n        "type": "keyword"\n      },\n      "join_field": { \n        "type": "join",\n        "relations": {\n          "goods": ["details","evaluate"],\n          "evaluate":"vote"\n        }\n      }\n    }\n  }\n}\nPUT my-index-000001/_doc/9?routing=1&amp;refresh\n{\n  "id": "9",\n  "text": "这是投票信息：我买iphone是因为性价比高，保值",\n  "join_field": {\n    "name": "vote",\n    "parent": "1"\n  }\n}\nPUT my-index-000001/_doc/10?routing=1&amp;refresh\n{\n  "id": "10",\n  "text": "这是投票信息：我买mac是因为轻，携带方便，没有流氓软件",\n  "join_field": {\n    "name": "vote",\n    "parent": "2"\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])])])]),s._v(" "),n("h1",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("相信大家也看出来了，官方都不建议使用父子文档的，毕竟性能是一大问题，相信大家用"),n("code",[s._v("Elasticsearch")]),s._v("肯定大部分都是图速度快，用了"),n("code",[s._v("Join")]),s._v("字段变慢了，这谁能同意呢是吧，有利有弊吧，看大家选择，下一篇带给大家的算是"),n("code",[s._v("Elasticsearch")]),s._v("推荐"),n("code",[s._v("Join")]),s._v("字段替代类型"),n("code",[s._v("Nested")])])])}),[],!1,null,null,null);n.default=t.exports}}]);