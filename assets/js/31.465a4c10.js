(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{438:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),e("ul",[e("li",[s._v("idea 2022.1.3")]),s._v(" "),e("li",[s._v("jdk17")]),s._v(" "),e("li",[s._v("macos 10.14.6")]),s._v(" "),e("li",[s._v("gradle 7.4.2(代码自动下载)")])]),s._v(" "),e("h1",{attrs:{id:"前置准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前置准备"}},[s._v("#")]),s._v(" 前置准备")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("idea")]),s._v(" 设置"),e("code",[s._v("JDK17")])]),s._v(" "),e("li",[e("code",[s._v("idea")]),s._v(" 设置"),e("code",[s._v("gradle JVM")]),s._v("为"),e("code",[s._v("Project JVM")])]),s._v(" "),e("li",[e("code",[s._v("gradle")]),s._v(" 设置"),e("code",[s._v("aliyun")]),s._v("加速（可选）,有时设置了不如不设置更好")])]),s._v(" "),e("h1",{attrs:{id:"开始导入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始导入"}},[s._v("#")]),s._v(" 开始导入")]),s._v(" "),e("ul",[e("li",[s._v("导入项目\n使用 "),e("code",[s._v("idea")]),s._v(" open项目下的"),e("code",[s._v("build.gradle")]),s._v("，等待编译结束")]),s._v(" "),e("li",[s._v("编译"),e("code",[s._v("8.1")]),s._v("版本的发行包\n这一步会下载所需的依赖"),e("code",[s._v("jdk")]),s._v("，如果报错可以多尝试几次，或者切换网络，执行该命令时，"),e("strong",[s._v("注意终端jdk环境")])])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("./gradlew localDistro\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("复制发行包到项目根目录同级目录新建"),e("code",[s._v("home")]),s._v("文件夹下，文件结构如下")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├── elasticsearch\n│   ├── BUILDING.md\n│   ├── CONTRIBUTING.md\n│   ├── LICENSE.txt\n│   ├── NOTICE.txt\n│   ├── README.asciidoc\n│   ├── README.md\n│   ├── TESTING.asciidoc\n│   ├── Vagrantfile\n│   ├── benchmarks\n│   ├── build\n│   ├── build-conventions\n│   ├── build-tools\n│   ├── build-tools-internal\n│   ├── build.gradle\n│   ├── ccr\n│   ├── checkstyle_ide.xml\n│   ├── client\n│   ├── dev-tools\n│   ├── distribution\n│   ├── docs\n│   ├── gradle\n│   ├── gradle.properties\n│   ├── gradlew\n│   ├── gradlew.bat\n│   ├── libs\n│   ├── licenses\n│   ├── modules\n│   ├── plugins\n│   ├── qa\n│   ├── rest-api-spec\n│   ├── server\n│   ├── settings.gradle\n│   ├── test\n│   └── x-pack\n├── home\n│   ├── LICENSE.txt\n│   ├── NOTICE.txt\n│   ├── README.asciidoc\n│   ├── bin\n│   ├── config\n│   ├── data\n│   ├── jdk.app\n│   ├── lib\n│   ├── logs\n│   ├── modules\n└── └── plugins\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br")])]),e("ul",[e("li",[s._v("启动\n找到"),e("code",[s._v("Elasticsearch.java")]),s._v(" 运行"),e("code",[s._v("main")]),s._v("方法")]),s._v(" "),e("li",[s._v("报错1："),e("code",[s._v("ERROR: the system property [es.path.conf] must be set")])])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-Des.path.conf=/cxt/codework/github/elasticsearch/8.1/home/config\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错2："),e("code",[s._v("path.home is not configured")])])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-Des.path.home=/cxt/codework/github/elasticsearch/8.1/home\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错3："),e("code",[s._v('main ERROR Could not register mbeans java.security.AccessControlException: access denied ("javax.management.MBeanTrustPermission" "register")')])]),s._v(" "),e("li",[s._v("创建一个"),e("code",[s._v("java.policy,")]),s._v("内容如下(完整内容在末尾获取)")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('grant {\n    permission javax.management.MBeanTrustPermission "register";\n};\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("运行时指定")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-Djava.security.policy=/cxt/codework/github/elasticsearch/8.1/home/config/java.policy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错4："),e("code",[s._v('access denied ("java.lang.RuntimePermission" "createClassLoader")')]),s._v("\n刚才的"),e("code",[s._v("java.policy")]),s._v("文件中增加如下(完整内容在末尾获取)")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('    permission java.lang.RuntimePermission "createClassLoader";\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错5："),e("code",[s._v('java.security.AccessControlException: access denied ("java.lang.RuntimePermission" "setContextClassLoader")')]),s._v("\n刚才的"),e("code",[s._v("java.policy")]),s._v("文件中增加如下(完整内容在末尾获取)")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('    permission java.lang.RuntimePermission "setContextClassLoader";\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错6："),e("code",[s._v('access denied ("org.elasticsearch.secure_sm.ThreadPermission" "modifyArbitraryThreadGroup")')]),s._v("\n刚才的"),e("code",[s._v("java.policy")]),s._v("文件中增加如下(完整内容在末尾获取)")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('    permission org.elasticsearch.secure_sm.ThreadPermission "modifyArbitraryThreadGroup";\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("报错7：报错如下(完整内容在末尾获取)")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Caused by: java.lang.IllegalArgumentException: Unknown codebases [codebase.elasticsearch-plugin-classloader, codebase.elasticsearch, codebase.elasticsearch-secure-sm] in policy file [file:/cxt/codework/github/elasticsearch/8.1/elasticsearch/server/out/production/resources/org/elasticsearch/bootstrap/security.policy]\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("解决如下，找到 "),e("code",[s._v("server/src/main/resources/org/elasticsearch/bootstrap/security.policy")]),s._v("，注释掉一下三个\n"),e("code",[s._v("[codebase.elasticsearch-plugin-classloader, codebase.elasticsearch, codebase.elasticsearch-secure-sm]")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('//grant codeBase "${codebase.elasticsearch-plugin-classloader}" {\n  // needed to create the classloader which allows plugins to extend other plugins\n  //permission java.lang.RuntimePermission "createClassLoader";\n//};\n\n//grant codeBase "${codebase.elasticsearch-secure-sm}" {\n//  permission java.security.AllPermission;\n//};\n\n//// Elasticsearch core:\n//// These are only allowed inside the server jar, not in plugins\n//grant codeBase "${codebase.elasticsearch}" {\n  // needed for loading plugins which may expect the context class loader to be set\n//  permission java.lang.RuntimePermission "setContextClassLoader";\n//};\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h1",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),e("ul",[e("li",[s._v("完整的启动参数设置如下")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-Des.path.conf=/cxt/codework/github/elasticsearch/8.1/home/config\n-Des.path.home=/cxt/codework/github/elasticsearch/8.1/home\n-Djava.security.policy=/cxt/codework/github/elasticsearch/8.1/home/config/java.policy\n-Dlog4j2.disable.jmx=true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("也可以在"),e("code",[s._v("Elasticsearch.main")]),s._v("方法执行前通过代码的形式指定环境变量(可选)")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('System.setProperty("es.path.conf","/cxt/codework/github/elasticsearch/8.1/home/config");\nSystem.setProperty("es.path.home", "/cxt/codework/github/elasticsearch/8.1/home");\nSystem.setProperty("log4j2.disable.jmx", "true");    System.setProperty("java.security.policy","/cxt/codework/github/elasticsearch/8.1/home/config/java.policy");\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("完整的"),e("code",[s._v("java.policy")]),s._v("文件如下")])]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('grant {\n    permission javax.management.MBeanTrustPermission "register";\n    permission java.lang.RuntimePermission "createClassLoader";\n    permission java.lang.RuntimePermission "setContextClassLoader";\n    permission org.elasticsearch.secure_sm.ThreadPermission "modifyArbitraryThreadGroup";\n};\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);