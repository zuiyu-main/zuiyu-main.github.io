(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{452:function(n,t,e){"use strict";e.r(t);var c=e(2),_=Object(c.a)({},(function(){var n=this,t=n._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"环境"}},[n._v("环境")]),n._v(" "),t("ul",[t("li",[n._v("Elasticsearch 8.1")]),n._v(" "),t("li",[n._v("Kibana 8.1")]),n._v(" "),t("li",[n._v("MacOS 10.14.6")])]),n._v(" "),t("h1",{attrs:{id:"简介"}},[n._v("简介")]),n._v(" "),t("p",[n._v("首先我们还是先了解一下，"),t("strong",[n._v("什么是字段别名？"),t("strong",[n._v("大家可能听说过")]),n._v("索引别名")]),n._v("，通过索引的别名可以轻松的切换所需的数据来源与哪一个索引，那么什么是字段别名呢？所谓字段别名，就是索引mapping定义时的备用字段，通过字段别名可以替换搜索请求中的目标字段，字段别名可以用于搜索，排序，聚合，高亮，docvalue_fields，stored_fields，suggestions，下面我们一起来看一下字段别名的详细使用过程")]),n._v(" "),t("h1",{attrs:{id:"使用"}},[n._v("使用")]),n._v(" "),t("h2",{attrs:{id:"定义字段别名规范"}},[n._v("定义字段别名规范")]),n._v(" "),t("ul",[t("li",[n._v("必须是一个明确的字段，不能是一个对象或者指向另一个字段别名")]),n._v(" "),t("li",[n._v("在创建字段别名时，字段别名指向的目标字段必须已经存在")]),n._v(" "),t("li",[n._v("如果定义了嵌套的对象，则字段别名必须具有同样的嵌套范围")])]),n._v(" "),t("p",[n._v("字段别名只能指向一个字段，不能同时指向多个字段；")]),n._v(" "),t("p",[n._v("但是可以通过修改mapping中的字段别名设置指向另一个新字段")]),n._v(" "),t("h2",{attrs:{id:"不支持使用字段别名的api"}},[n._v("不支持使用字段别名的API")]),n._v(" "),t("ul",[t("li",[n._v("首先是不能在写入数据的时候使用字段别名，因为本身字段别名是虚拟的，不存在的，所以不支持写入，同样也不能用于copy_to")]),n._v(" "),t("li",[n._v("因为字段的别名是不存在_source中的，所以搜索请求时的过滤字段也是不会生效的")])]),n._v(" "),t("h1",{attrs:{id:"测试"}},[n._v("测试")]),n._v(" "),t("ul",[t("li",[t("p",[n._v("创建索引，定义字段别名")]),n._v(" "),t("p",[n._v("其中创建了索引blog1和blog2,各自定义了两个字段别名public_count和public_content,在blog1索引中，public_count指向doc.count,public_content指向doc.content;在blog2索引中，public_count指向doc_count,public_content指向doc_content;")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('PUT blog1\n{\n  "mappings": {\n    "properties": {\n      "doc": {\n        "properties": {\n          "count": {\n            "type": "long"\n          },\n          "content": {\n            "type": "text",\n            "fields": {\n              "keyword": {\n                "type": "keyword"\n              }\n            }\n          }\n        }\n      },\n      "creater": {\n        "type": "keyword"\n      },\n      "public_count": {\n        "type": "alias",\n        "path": "doc.count"\n      },\n      "public_content": {\n        "type": "alias",\n        "path": "doc.content"\n      }\n    }\n  }\n}\n\n\nPUT blog2\n{\n  "mappings": {\n    "properties": {\n      "doc_count": {\n        "type": "long"\n      },\n      "doc_content": {\n        "type": "text",\n        "fields": {\n          "keyword": {\n            "type": "keyword"\n          }\n        }\n      },\n      "creater": {\n        "type": "keyword"\n      },\n      "public_count": {\n        "type": "alias",\n        "path": "doc_count"\n      },\n      "public_content": {\n        "type": "alias",\n        "path": "doc_content"\n      }\n    }\n  }\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("插入测试数据")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('POST _bulk\n{ "index":{"_index":"blog1","_id":"1"}}\n{"creater":"zuiyu1","doc.count":"100","doc.content":"zuiyu elasticsearch "}\n{ "index":{"_index":"blog1","_id":"2"}}\n{"creater":"zuiyu2","doc.count":"200","doc.content":"zuiyu vue"}\n{ "index":{"_index":"blog1","_id":"3"}}\n{"creater":"zuiyu3","doc.count":"300","doc.content":"java demo"}\n{ "index":{"_index":"blog1","_id":"4"}}\n{"creater":"zuiyu4","doc.count":"300","doc.content":"java demo plus"}\n{ "index":{"_index":"blog1","_id":"5"}}\n{"creater":"zuiyu5","doc.count":"300","doc.content":"java pro and elasticsearch"}\n{ "index":{"_index":"blog2","_id":"1"}}\n{"creater":"zuiyu1","doc_count":"10","doc_content":"醉鱼ES小白入门课"}\n{ "index":{"_index":"blog2","_id":"2"}}\n{"creater":"zuiyu2","doc_count":"550","doc_content":"醉鱼前端 vue 小白入门课"}\n{ "index":{"_index":"blog2","_id":"3"}}\n{"creater":"zuiyu3","doc_count":"60","doc_content":"醉鱼java小白入门课"}\n{ "index":{"_index":"blog2","_id":"4"}}\n{"creater":"zuiyu4","doc_count":"60","doc_content":"醉鱼MySQL8.0小白入门课"}\n{ "index":{"_index":"blog2","_id":"5"}}\n{"creater":"zuiyu5","doc_count":"60","doc_content":"醉鱼Redis小白入门课"}\n\n')])])])]),n._v(" "),t("li",[t("p",[n._v("搜索测试、聚合、排序、高亮、建议")]),n._v(" "),t("p",[n._v("目标是实现搜索索引blog1和blog2中content内容中包含java的文档,因为两个索引的mapping结构完全不一样，所以使用定义的相同名称的public_count和public_content")]),n._v(" "),t("ul",[t("li",[t("p",[n._v("聚合")]),n._v(" "),t("p",[n._v("使用public_count字段搜索索引blog1和blog2中public_count 大于100的文档，对public_count进行聚合分桶")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search?size=0\n{\n  "query": {\n    "range": {\n      "public_count": {\n        "gte": 100\n        }\n    }\n  },\n  "aggs": {\n    "all_agg": {\n      "terms": {\n        "field": "public_count"\n      }\n    }\n  }\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("排序")]),n._v(" "),t("p",[n._v("使用public_count字段搜索索引blog1和blog2中public_count结果大于100的文档,对public_count进行降序输出")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search\n{\n  "query": {\n    "range": {\n      "public_count": {\n        "gte": 100\n        }\n    }\n  },\n  "sort": [\n    {\n      "public_count": {\n        "order": "desc"\n      }\n    }\n  ]\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("高亮")]),n._v(" "),t("p",[n._v("使用public_content字段搜索索引blog1和blog2中包含java的，高亮输出，结果前后加上em标签")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search\n{\n  "query": {\n    "wildcard": {\n      "public_content": {\n        "value": "*java*"\n      }\n    }\n  },\n  "highlight": {\n    "fields": {\n      "public_content": {\n        "pre_tags": [\n          "&lt;em>"\n        ],\n        "post_tags": [\n          "&lt;/em>"\n        ]\n      }\n    }\n  }\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("建议")]),n._v(" "),t("p",[n._v("使用public_count字段搜索索引blog1和blog2中搜索public_content中包含java的文档，输入一个错误单词jave,建议返回java")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search\n{\n  "query": {\n    "wildcard": {\n      "public_content": {\n        "value": "*java*"\n      }\n    }\n  },\n  "suggest": {\n    "YOUR_SUGGESTION": {\n      "text": "jave",\n      "term": {\n        "field": "public_content"\n      }\n    }\n  }\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("_source测试")]),n._v(" "),t("p",[n._v("使用_source测试返回字段public_count，public_content，因为字段别名是虚拟的，所以此时是没有返回结果的")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search\n{\n  "query": {\n    "wildcard": {\n      "public_content": {\n        "value": "*java*"\n      }\n    }\n  },\n  "_source": [\n    "public_count",\n    "public_content"\n  ]\n}\n')])])])]),n._v(" "),t("li",[t("p",[n._v("使用docvalue_fields请求字段获取")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('GET blog*/_search\n{\n  "query": {\n    "wildcard": {\n      "public_content": {\n        "value": "*java*"\n      }\n    }\n  },\n   "docvalue_fields": [\n    "public_count"\n  ]\n}\n')])])])])])])]),n._v(" "),t("h1",{attrs:{id:"使用场景"}},[n._v("使用场景")]),n._v(" "),t("p",[n._v("简单总结一下字段别名的使用场景：")]),n._v(" "),t("ul",[t("li",[n._v("文中的例子，可以对同一个人在不同博客网站上写的内容进行统计")]),n._v(" "),t("li",[n._v("获取采集的日志信息，不同的数据源，索引的日志mapping不一样，统计时就可以使用字段别名进行统一的统计")])])])}),[],!1,null,null,null);t.default=_.exports}}]);