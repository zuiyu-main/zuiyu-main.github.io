(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{434:function(n,e,t){"use strict";t.r(e);var s=t(2),a=Object(s.a)({},(function(){var n=this,e=n._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("hr"),n._v(" "),e("p",[n._v("title: Elasticsearch snapshots 快照使用教程\ndate: 2019-01-01\ntags:")]),n._v(" "),e("ul",[e("li",[n._v("Elasticsearch\ncategories:")]),n._v(" "),e("li",[n._v("Elasticsearch")])]),n._v(" "),e("hr"),n._v(" "),e("h1",{attrs:{id:"elasticsearch-6-5-操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-6-5-操作"}},[n._v("#")]),n._v(" elasticsearch 6.5 操作")]),n._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/6.8/modules-snapshots.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("阅读原文"),e("OutboundLink")],1)]),n._v(" "),e("li",[n._v("启动es 配置 elasticsearch.yml")])]),n._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('path.repo: ["my_backup_location"]\n启动容器可以直接映射出来\n-v $sp/my_backup_location:/usr/share/elasticsearch/my_backup_location \\\n\n\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br")])]),e("ul",[e("li",[n._v("创建一个测试索引")])]),n._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('\ncurl -X PUT "localhost:9200/my_index?pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "mappings": {\n    "_doc": { \n      "properties": { \n        "title":    { "type": "text"  }, \n        "name":     { "type": "text"  }, \n        "age":      { "type": "integer" },  \n        "created":  {\n          "type":   "date", \n          "format": "strict_date_optional_time||epoch_millis"\n        }\n      }\n    }\n  }\n}\n\'\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("ul",[e("li",[n._v("创建快照")])]),n._v(" "),e("p",[n._v('curl -X PUT "localhost:9200/_snapshot/my_index?pretty" -H \'Content-Type: application/json\' -d\'\n{\n"type": "fs",\n"settings": {\n"location": "my_index_location"\n}\n}\n\'')]),n._v(" "),e("ul",[e("li",[n._v("创建指定索引的快照")])]),n._v(" "),e("p",[n._v('curl -X PUT "localhost:9200/_snapshot/my_index/snapshot_2?wait_for_completion=true&pretty" -H \'Content-Type: application/json\' -d\'\n{\n"indices": "my_index",\n"ignore_unavailable": true,\n"include_global_state": false\n}\n\'')]),n._v(" "),e("ul",[e("li",[n._v("导出带日期的快照")])]),n._v(" "),e("p",[n._v('curl -X PUT "localhost:9200/_snapshot/my_index/%3Csnapshot-%7Bnow%2Fd%7D%3E?pretty"')]),n._v(" "),e("ul",[e("li",[n._v("读取带日期的快照")])]),n._v(" "),e("p",[n._v('curl -X GET "localhost:9200/_snapshot/my_index/snapshot-2020.06.22?pretty"\ncurl -X GET "localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_status?pretty"')]),n._v(" "),e("ul",[e("li",[n._v("还原，任选一个")])]),n._v(" "),e("p",[n._v("代码解释\nmy_index 为要还原的索引名称，这个名称要与创建快照的名称相同\nsnapshot-2020.06.22 创建的日期快照")]),n._v(" "),e("p",[n._v('curl -X POST "localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_restore?pretty"')]),n._v(" "),e("p",[n._v("index_1,需要还原快照的索引名称 ，根据快照状态获取indices信息查看快照的信息")]),n._v(" "),e("p",[n._v('curl -X POST "localhost:9200/'),e("em",[n._v("snapshot/my_index/snapshot-2020.06.22/"),e("em",[n._v('restore?pretty" -H \'Content-Type: application/json\' -d\'\n{\n"indices": "index_1,index_2",\n"ignore_unavailable": true,\n"include_global_state": true,\n"rename_pattern": "index')]),n._v('(.+)",\n"rename_replacement": "restored_index')]),n._v("$1\"\n}\n'")]),n._v(" "),e("ul",[e("li",[n._v("获取还原状态")])]),n._v(" "),e("p",[n._v('curl -X GET "localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_status?pretty"')]),n._v(" "),e("ul",[e("li",[n._v("设置demo 数据")])]),n._v(" "),e("p",[n._v('curl -X POST "localhost:9200/_bulk?pretty" -H \'Content-Type: application/json\' -d\'\n{ "index" : { "_index" : "my_index", "_type" : "_doc", "_id" : "1" } }\n{ "title" : "标题1", "name":"name1","age":"1"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "2" } }\n{ "title" : "标题2", "name":"name2","age":"2"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "3" } }\n{ "title" : "标题3", "name":"name3","age":"3"}\n\'')]),n._v(" "),e("ul",[e("li",[n._v("读取数据")])]),n._v(" "),e("p",[n._v('curl -X GET "localhost:9200/my_index/_doc/1?pretty"')]),n._v(" "),e("ul",[e("li",[n._v("删除数据")])]),n._v(" "),e("p",[n._v('curl -X DELETE "localhost:9200/my_index/_doc/1?pretty"')])])}),[],!1,null,null,null);e.default=a.exports}}]);