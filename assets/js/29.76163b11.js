(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{437:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("blockquote",[e("p",[e("strong",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/8.1/aggregate-metric-double.html")])])]),s._v(" "),e("h1",{attrs:{id:"环境信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境信息"}},[s._v("#")]),s._v(" 环境信息")]),s._v(" "),e("ul",[e("li",[s._v("Elasticsearch 8.1")]),s._v(" "),e("li",[s._v("Kibana 8.1")]),s._v(" "),e("li",[s._v("MacOS 10.14.6")])]),s._v(" "),e("h1",{attrs:{id:"描述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[s._v("#")]),s._v(" 描述")]),s._v(" "),e("p",[s._v("今天我们学习一下Elasticsearch的聚合字段类型，所谓聚合字段类型，类型设置为"),e("code",[s._v("aggregate_metric_double")]),s._v("作为一个对象，子字段可以有"),e("code",[s._v("min")]),s._v(","),e("code",[s._v("max")]),s._v(","),e("code",[s._v("sum")]),s._v(","),e("code",[s._v("value_count")]),s._v(",当我们对字段设置为"),e("code",[s._v("aggregate_metric_double")]),s._v("类型的字段做聚合时，它能够直接使用子字段的值进行聚合，比如最大值就可以直接去子对象中"),e("code",[s._v("max")]),s._v("的值比较")]),s._v(" "),e("h1",{attrs:{id:"参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[s._v("#")]),s._v(" 参数")]),s._v(" "),e("p",[e("code",[s._v("aggregate_metric_double")]),s._v("类型的字段支持以下三个参数的设置")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("metrics")]),s._v(" "),e("p",[s._v("必填、数组值、最少包含以下值的一个**[min,max,sum,value_count]**")])]),s._v(" "),e("li",[e("p",[s._v("default_metric")]),s._v(" "),e("p",[s._v("聚合子字段查询，script的字段设置，字符串，必须是"),e("code",[s._v("metrics")]),s._v("数组中的一个")])]),s._v(" "),e("li",[e("p",[s._v("time_series_metric")]),s._v(" "),e("p",[s._v("可选，字符串值，默认为空，支持"),e("code",[s._v("counter")]),s._v(","),e("code",[s._v("gauge")]),s._v(","),e("code",[s._v("summary")]),s._v("中的某一个。当前版本为预览功能，最新版参考")]),s._v(" "),e("blockquote",[e("p",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/master/tsds.html#time-series-metric")]),s._v(" "),e("p",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/master/aggregate-metric-double.html")])])])]),s._v(" "),e("h1",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("min 使用子字段的"),e("code",[s._v("min")]),s._v("字段进行聚合统计")])]),s._v(" "),e("li",[e("p",[s._v("max 使用子字段的"),e("code",[s._v("max")]),s._v("字段进行聚合统计")])]),s._v(" "),e("li",[e("p",[s._v("sum 使用子字段的"),e("code",[s._v("sum")]),s._v("字段进行聚合统计")])]),s._v(" "),e("li",[e("p",[s._v("value_count 使用子字段的"),e("code",[s._v("value_count")]),s._v("字段进行聚合统计")])]),s._v(" "),e("li",[e("p",[s._v("avg 这个比较特殊，他没有子字段，他使用"),e("code",[s._v("sum")]),s._v("和"),e("code",[s._v("value_count")]),s._v("两个字段聚合的结果，也就是说聚合字段的子对象必须同时包含"),e("code",[s._v("sum")]),s._v("与"),e("code",[s._v("value_count")])])])]),s._v(" "),e("h1",{attrs:{id:"验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),e("p",[s._v("如下是测试的例子，参考如下")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("首先我们还是通过Kibana 创建一个索引，索引中就包含一个"),e("code",[s._v("aggregate_metric_double")]),s._v("类型的一个对象字段")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('PUT my-index-006\n{\n  "mappings": {\n    "properties": {\n      "zuiyu_agg_metric_field":{\n        "type":"aggregate_metric_double",\n        "metrics":["min","max","sum","value_count"],\n        "default_metric":"max"   \n        }\n    }\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("下面是插入测试数据")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('POST _bulk\n{"index":{"_index":"my-index-006","_id":"1"}}\n{"zuiyu_agg_metric_field":{"min":100.00,"max":1000.00,"sum":5000.00,"value_count":10}}\n{"index":{"_index":"my-index-006","_id":"2"}}\n{"zuiyu_agg_metric_field":{"min":-10.00,"max":30.00,"sum":70.00,"value_count":8}}\n{"index":{"_index":"my-index-006","_id":"3"}}\n{"zuiyu_agg_metric_field":{"min":-90.00,"max":300.00,"sum":200.00,"value_count":5}}\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("搜索聚合统计验证(?size=0 不反悔查询结果只返回聚合结果)")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('GET my-index-006/_search?size=0\n{\n  "aggs": {\n    "zuiyu_min": {\n      "min": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_max": {\n      "max": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_sum": {\n      "sum": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_value_count": {\n      "value_count": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_avg": {\n      "avg": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    }\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("测试"),e("code",[s._v("default_metric")]),s._v("字段对查询时的默认匹配与排序")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('GET my-index-006/_search\n{\n  "query": {\n    "term": {\n      "zuiyu_agg_metric_field": {\n        "value": "30"\n      }\n    }\n  }\n}\n\nGET my-index-006/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [\n    {\n      "zuiyu_agg_metric_field": {\n        "order": "asc"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])])])]),s._v(" "),e("h1",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),e("p",[s._v("字段类型为"),e("code",[s._v("aggregate_metric_double")]),s._v("的字段，可以设置"),e("code",[s._v("metrics")]),s._v(",支持"),e("code",[s._v("min")]),s._v("，"),e("code",[s._v("max")]),s._v("，"),e("code",[s._v("sum")]),s._v("，"),e("code",[s._v("value_count")]),s._v("，"),e("code",[s._v("avg")]),s._v("五中，其中"),e("code",[s._v("avg")]),s._v("不显示设置，"),e("code",[s._v("avg")]),s._v("取值"),e("code",[s._v("sum")]),s._v("和"),e("code",[s._v("value_count")]),s._v("。设置字段之后我们之后的聚合操作可以直接使用类型为"),e("code",[s._v("aggregate_metric_double")]),s._v("字段的子对象中对应的"),e("code",[s._v("max")]),s._v(","),e("code",[s._v("min")]),s._v(","),e("code",[s._v("sum")]),s._v(","),e("code",[s._v("value_count")]),s._v("进行聚合")])])}),[],!1,null,null,null);e.default=t.exports}}]);