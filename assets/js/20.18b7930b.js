(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{450:function(e,t,_){"use strict";_.r(t);var a=_(2),i=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("blockquote",[t("p",[t("strong",[e._v("https://www.elastic.co/guide/en/elasticsearch/reference/8.1/aggregate-metric-double.html")])])]),e._v(" "),t("h1",{attrs:{id:"环境信息"}},[e._v("环境信息")]),e._v(" "),t("ul",[t("li",[e._v("Elasticsearch 8.1")]),e._v(" "),t("li",[e._v("Kibana 8.1")]),e._v(" "),t("li",[e._v("MacOS 10.14.6")])]),e._v(" "),t("h1",{attrs:{id:"描述"}},[e._v("描述")]),e._v(" "),t("p",[e._v("今天我们学习一下Elasticsearch的聚合字段类型，所谓聚合字段类型，类型设置为aggregate_metric_double作为一个对象，子字段可以有min,max,sum,value_count,当我们对字段设置为aggregate_metric_double类型的字段做聚合时，它能够直接使用子字段的值进行聚合，比如最大值就可以直接去子对象中max的值比较")]),e._v(" "),t("h1",{attrs:{id:"参数"}},[e._v("参数")]),e._v(" "),t("p",[e._v("aggregate_metric_double类型的字段支持以下三个参数的设置")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("metrics")]),e._v(" "),t("p",[e._v("必填、数组值、最少包含以下值的一个**[min,max,sum,value_count]**")])]),e._v(" "),t("li",[t("p",[e._v("default_metric")]),e._v(" "),t("p",[e._v("聚合子字段查询，script的字段设置，字符串，必须是metrics数组中的一个")])]),e._v(" "),t("li",[t("p",[e._v("time_series_metric")]),e._v(" "),t("p",[e._v("可选，字符串值，默认为空，支持counter,gauge,summary中的某一个。当前版本为预览功能，最新版参考")]),e._v(" "),t("blockquote",[t("p",[e._v("https://www.elastic.co/guide/en/elasticsearch/reference/master/tsds.html#time-series-metric")]),e._v(" "),t("p",[e._v("https://www.elastic.co/guide/en/elasticsearch/reference/master/aggregate-metric-double.html")])])])]),e._v(" "),t("h1",{attrs:{id:"使用"}},[e._v("使用")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("min 使用子字段的min字段进行聚合统计")])]),e._v(" "),t("li",[t("p",[e._v("max 使用子字段的max字段进行聚合统计")])]),e._v(" "),t("li",[t("p",[e._v("sum 使用子字段的sum字段进行聚合统计")])]),e._v(" "),t("li",[t("p",[e._v("value_count 使用子字段的value_count字段进行聚合统计")])]),e._v(" "),t("li",[t("p",[e._v("avg 这个比较特殊，他没有子字段，他使用sum和value_count两个字段聚合的结果，也就是说聚合字段的子对象必须同时包含sum与value_count")])])]),e._v(" "),t("h1",{attrs:{id:"验证"}},[e._v("验证")]),e._v(" "),t("p",[e._v("如下是测试的例子，参考如下")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("首先我们还是通过Kibana 创建一个索引，索引中就包含一个aggregate_metric_double类型的一个对象字段")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('PUT my-index-006\n{\n  "mappings": {\n    "properties": {\n      "zuiyu_agg_metric_field":{\n        "type":"aggregate_metric_double",\n        "metrics":["min","max","sum","value_count"],\n        "default_metric":"max"   \n        }\n    }\n  }\n}\n')])])])]),e._v(" "),t("li",[t("p",[e._v("下面是插入测试数据")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('POST _bulk\n{"index":{"_index":"my-index-006","_id":"1"}}\n{"zuiyu_agg_metric_field":{"min":100.00,"max":1000.00,"sum":5000.00,"value_count":10}}\n{"index":{"_index":"my-index-006","_id":"2"}}\n{"zuiyu_agg_metric_field":{"min":-10.00,"max":30.00,"sum":70.00,"value_count":8}}\n{"index":{"_index":"my-index-006","_id":"3"}}\n{"zuiyu_agg_metric_field":{"min":-90.00,"max":300.00,"sum":200.00,"value_count":5}}\n\n')])])])]),e._v(" "),t("li",[t("p",[e._v("搜索聚合统计验证(?size=0 不反悔查询结果只返回聚合结果)")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('GET my-index-006/_search?size=0\n{\n  "aggs": {\n    "zuiyu_min": {\n      "min": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_max": {\n      "max": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_sum": {\n      "sum": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_value_count": {\n      "value_count": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    },\n    "zuiyu_avg": {\n      "avg": {\n        "field": "zuiyu_agg_metric_field"\n      }\n    }\n  }\n}\n')])])])]),e._v(" "),t("li",[t("p",[e._v("测试default_metric字段对查询时的默认匹配与排序")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('GET my-index-006/_search\n{\n  "query": {\n    "term": {\n      "zuiyu_agg_metric_field": {\n        "value": "30"\n      }\n    }\n  }\n}\n\nGET my-index-006/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [\n    {\n      "zuiyu_agg_metric_field": {\n        "order": "asc"\n      }\n    }\n  ]\n}\n')])])])])]),e._v(" "),t("h1",{attrs:{id:"总结"}},[e._v("总结")]),e._v(" "),t("p",[e._v("字段类型为aggregate_metric_double的字段，可以设置metrics,支持min，max，sum，value_count，avg五中，其中avg不显示设置，avg取值sum和value_count。设置字段之后我们之后的聚合操作可以直接使用类型为aggregate_metric_double字段的子对象中对应的max,min,sum,value_count进行聚合")])])}),[],!1,null,null,null);t.default=i.exports}}]);