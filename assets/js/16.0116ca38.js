(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{441:function(a,s,t){"use strict";t.r(s);var e=t(2),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"elasticsearch-6-5-操作"}},[a._v("elasticsearch 6.5 操作")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/6.8/modules-snapshots.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("阅读原文"),s("OutboundLink")],1)]),a._v(" "),s("li",[a._v("启动es 配置 elasticsearch.yml")])]),a._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('path.repo: ["my_backup_location"]\n启动容器可以直接映射出来\n-v $sp/my_backup_location:/usr/share/elasticsearch/my_backup_location \\\n\n\n')])])]),s("ul",[s("li",[a._v("创建一个测试索引")])]),a._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('\ncurl -X PUT "localhost:9200/my_index?pretty" -H \'Content-Type: application/json\' -d\'\n{\n  "mappings": {\n    "_doc": { \n      "properties": { \n        "title":    { "type": "text"  }, \n        "name":     { "type": "text"  }, \n        "age":      { "type": "integer" },  \n        "created":  {\n          "type":   "date", \n          "format": "strict_date_optional_time||epoch_millis"\n        }\n      }\n    }\n  }\n}\n\'\n')])])]),s("ul",[s("li",[a._v("创建快照")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index?pretty"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" -d"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'\n{\n  "type": "fs",\n  "settings": {\n    "location": "my_index_location"\n  }\n}\n\'')]),a._v("\n")])])]),s("ul",[s("li",[a._v("创建指定索引的快照")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot_2?wait_for_completion=true&pretty"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" -d"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'\n{\n  "indices": "my_index",\n  "ignore_unavailable": true,\n  "include_global_state": false\n}\n\'')]),a._v("\n")])])]),s("ul",[s("li",[a._v("导出带日期的快照")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/%3Csnapshot-%7Bnow%2Fd%7D%3E?pretty"')]),a._v("\n\n")])])]),s("ul",[s("li",[a._v("读取带日期的快照")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot-2020.06.22?pretty"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_status?pretty"')]),a._v("\n")])])]),s("ul",[s("li",[a._v("还原，任选一个")])]),a._v(" "),s("p",[a._v("代码解释\nmy_index 为要还原的索引名称，这个名称要与创建快照的名称相同")]),a._v(" "),s("p",[a._v("snapshot-2020.06.22 创建的日期快照")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_restore?pretty"')]),a._v("\n")])])]),s("p",[a._v("index_1,需要还原快照的索引名称 ，根据快照状态获取indices信息查看快照的信息")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_restore?pretty"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" -d"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'\n{\n  "indices": "index_1,index_2",\n  "ignore_unavailable": true,\n  "include_global_state": true,\n  "rename_pattern": "index_(.+)",\n  "rename_replacement": "restored_index_$1"\n}\n\'')]),a._v("\n")])])]),s("ul",[s("li",[a._v("获取还原状态")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_snapshot/my_index/snapshot-2020.06.22/_status?pretty"')]),a._v("\n")])])]),s("ul",[s("li",[a._v("设置demo 数据")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/_bulk?pretty"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" -d"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'\n{ "index" : { "_index" : "my_index", "_type" : "_doc", "_id" : "1" } }\n{ "title" : "标题1", "name":"name1","age":"1"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "2" } }\n{ "title" : "标题2", "name":"name2","age":"2"}\n{ "create" : { "_index" : "my_index", "_type" : "_doc", "_id" : "3" } }\n{ "title" : "标题3", "name":"name3","age":"3"}\n\'')]),a._v("\n")])])]),s("ul",[s("li",[a._v("读取数据")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/my_index/_doc/1?pretty"')]),a._v("\n")])])]),s("ul",[s("li",[a._v("删除数据")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" DELETE "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9200/my_index/_doc/1?pretty"')]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);