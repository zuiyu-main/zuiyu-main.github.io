(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{454:function(s,n,a){"use strict";a.r(n);var t=a(2),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("img",{staticStyle:{zoom:"100%"},attrs:{src:"大文本的全文检索方案外部文件索引与索引附件.assets/image-20230818154459861.png",alt:"image-20230818154459861"}}),s._v(" "),n("h1",{attrs:{id:"一、简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、简介"}},[s._v("#")]),s._v(" 一、简介")]),s._v(" "),n("p",[n("strong",[s._v("Elasticsearch")]),s._v("附件索引是需要插件支持的功能，它允许将文件内容附加到"),n("strong",[s._v("Elasticsearch")]),s._v("文档中，并对这些附件内容进行全文检索。本文将带你了解索引附件的原理和使用方法，并通过一个实际示例来说明如何在"),n("strong",[s._v("Elasticsearch")]),s._v("中索引和检索文件附件。")]),s._v(" "),n("p",[s._v("索引附件的核心原理是通过"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("将文件内容转换成"),n("strong",[s._v("Elasticsearch")]),s._v("文档中的字段。该插件使用"),n("strong",[s._v("Apache Tika")]),s._v("来提取文档中的附件内容，并将其转换为可索引的文本。")]),s._v(" "),n("h1",{attrs:{id:"二、环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、环境"}},[s._v("#")]),s._v(" 二、环境")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('version: \'3.8\'\nservices:\n  cerebro:\n    image: lmenezes/cerebro:0.8.3\n    container_name: cerebro\n    ports:\n     - "9000:9000"\n    command:\n     - -Dhosts.0.host=http://eshot:9200\n    networks:\n     - elastic\n  kibana:\n    image: docker.elastic.co/kibana/kibana:8.1.3\n    container_name: kibana\n    environment:\n      - I18N_LOCALE=zh-CN\n      - XPACK_GRAPH_ENABLED=true\n      - TIMELION_ENABLED=true\n      - XPACK_MONITORING_COLLECTION_ENABLED="true"\n      - ELASTICSEARCH_HOSTS=http://eshot:9200\n      - server.publicBaseUrl=http://192.168.160.234:5601\n    ports:\n      - "5601:5601"\n    networks:\n      - elastic\n  eshot:\n    image: elasticsearch:8.1.3\n    container_name: eshot\n    environment:\n      - node.name=eshot\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=hot\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    ports:\n      - 9200:9200\n    networks:\n      - elastic\n  eswarm:\n    image: elasticsearch:8.1.3\n    container_name: eswarm\n    environment:\n      - node.name=eswarm\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=warm\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n  escold:\n    image: elasticsearch:8.1.3\n    container_name: escold\n    environment:\n      - node.name=escold\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=cold\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n\n# volumes:\n#   eshotdata:\n#     driver: local\n#   eswarmdata:\n#     driver: local\n#   escolddata:\n#     driver: local\n\nnetworks:\n  elastic:\n    driver: bridge\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br")])]),n("h1",{attrs:{id:"三、安装-ingest-attachment-插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、安装-ingest-attachment-插件"}},[s._v("#")]),s._v(" 三、安装 ingest-attachment 插件")]),s._v(" "),n("p",[s._v("首先创建一个处理文本的管道，指定读取文档中"),n("code",[s._v("content")]),s._v("字段的内容进行处理")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT _ingest/pipeline/attachment\n{\n  "description" : "Extract attachment information",\n  "processors" : [\n    {\n      "attachment" : {\n        "field" : "content"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("我们的"),n("strong",[s._v("elasticsearch")]),s._v("版本是"),n("code",[s._v("8.1")]),s._v("，所以默认还是没有内置的，需要手动添加一下，因为我是"),n("strong",[s._v("docker")]),s._v("启动的，所以进入到"),n("strong",[s._v("docker")]),s._v("容器内部，执行如下命令进行安装")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./bin/elasticsearch-plugin install ingest-attachment\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装完成之后进行重启"),n("strong",[s._v("elasticsearch")]),s._v("集群进行激活插件的启用")]),s._v(" "),n("blockquote",[n("p",[s._v("我这边是三个节点，在hot节点下安装完成之后只会在当前节点下有此插件")])]),s._v(" "),n("p",[s._v("现在插件已经安装好了，继续执行刚才的定义文本处理通道进行创建")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT _ingest/pipeline/attachment\n{\n  "description" : "Extract attachment information",\n  "processors" : [\n    {\n      "attachment" : {\n        "field" : "content"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("在上面的定义中指定的"),n("code",[s._v("attachment")]),s._v("的过滤字段是"),n("code",[s._v("content")]),s._v("，所以我们在写入"),n("strong",[s._v("elasticsearch")]),s._v("索引内容时，文件的内容需要保存到"),n("code",[s._v("content")]),s._v("字段中")]),s._v(" "),n("h1",{attrs:{id:"四、添加测试数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、添加测试数据"}},[s._v("#")]),s._v(" 四、添加测试数据")]),s._v(" "),n("p",[s._v("下面我们创建一个保存文档详细信息的索引，比如文件题名，类型，文件内容等字段")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /zfc-doc-000003\n{\n  "mappings": {\n    "properties": {\n      "id":{\n        "type": "keyword"\n      },\n      "title":{\n        "type": "text",\n        "analyzer": "ik_max_word"\n      },\n      "content": {\n        "type": "text",\n        "analyzer": "ik_max_word"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("通过上面两步的操作之后我们的测试环境就算搭建完成了，下面就可以进行大文本内容的读取测试了，首先我们还是准备几个测试的文本文件，比如"),n("code",[s._v("txt")]),s._v("，"),n("code",[s._v("doc")]),s._v("，"),n("code",[s._v("pdf")]),s._v("等类型的纯文本文件")]),s._v(" "),n("p",[s._v("下面使用"),n("code",[s._v("python")]),s._v("脚本写入索引内容，首先安装一下"),n("code",[s._v("elasticsearch")]),s._v("的相关依赖")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("pip install elasticsearch\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("下面是读取文件夹"),n("code",[s._v("C://Users//zuiyu//Documents//mydoc//20230806//demo//1")]),s._v("下的所有文本文件保存到"),n("code",[s._v("elasticsearch")]),s._v("的索引"),n("code",[s._v("zfc-doc-000003")]),s._v("中的python脚本，保存为"),n("code",[s._v("txt.py")]),s._v("后面会用到")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" elasticsearch "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Elasticsearch\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" base64\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义Elasticsearch客户端连接")]),s._v("\nes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Elasticsearch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:9200"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义索引名称")]),s._v("\nindex_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zfc-doc-000003"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义文件夹路径")]),s._v("\nfolder_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C://Users//zuiyu//Documents//mydoc//20230806//demo//1"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 遍历文件夹下的所有文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dirs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" files "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("walk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("folder_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" filename "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建文件的完整路径")]),s._v("\n        file_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取文件内容，并以字节类型（bytes-like）返回")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rb"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            file_content "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用base64.b64encode()函数将文件内容转换为base64编码")]),s._v("\n        base64_content "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b64encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建索引文档")]),s._v("\n        document_body "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用文件名作为文档标题")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"content"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" base64_content  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 将base64编码后的内容保存到字段 "content" 中')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 执行索引操作，并指定pipeline为 "attachment"')]),s._v("\n        es"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" body"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("document_body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pipeline"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"attachment"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"所有文件已成功保存到Elasticsearch索引中。"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("p",[s._v("该脚本中需要注意的点有如下三个")]),s._v(" "),n("p",[s._v("1、"),n("strong",[s._v("elasticsearch")]),s._v("服务器地址")]),s._v(" "),n("p",[s._v("2、需要读取的文件夹地址")]),s._v(" "),n("p",[s._v("3、保存的索引名称与保存文本内容的字段名称")]),s._v(" "),n("p",[s._v("4、指定创建的"),n("code",[s._v("pipeline")])]),s._v(" "),n("p",[n("code",[s._v("C://Users//zuiyu//Documents//mydoc//20230806//demo//1")]),s._v("文件夹下有三个文件用来做测试，他们的文本内容分别如下图所示")]),s._v(" "),n("p",[n("img",{attrs:{src:"%E5%A4%A7%E6%96%87%E6%9C%AC%E7%9A%84%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E6%96%B9%E6%A1%88%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6%E7%B4%A2%E5%BC%95%E4%B8%8E%E7%B4%A2%E5%BC%95%E9%99%84%E4%BB%B6.assets/image-20230808153241638.png",alt:"image-20230808153241638"}})]),s._v(" "),n("blockquote",[n("p",[s._v("其中为了方便测试，1.txt与2.txt仅有一句话")])]),s._v(" "),n("p",[s._v("下面执行"),n("code",[s._v("python")]),s._v("脚本"),n("code",[s._v("txt.py")]),s._v("保存到"),n("code",[s._v("elasticsearch")]),s._v("的"),n("code",[s._v("zfc-doc-000003")]),s._v("中，并指定使用"),n("code",[s._v("pipeline")]),s._v("为"),n("code",[s._v("attachment")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("python txt.py\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("脚本执行成功之后的截图如下图所示，输出"),n("code",[s._v("所有文件已成功保存到Elasticsearch索引中。")]),s._v("即为成功导入")]),s._v(" "),n("p",[n("img",{attrs:{src:"%E5%A4%A7%E6%96%87%E6%9C%AC%E7%9A%84%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E6%96%B9%E6%A1%88%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6%E7%B4%A2%E5%BC%95%E4%B8%8E%E7%B4%A2%E5%BC%95%E9%99%84%E4%BB%B6.assets/image-20230806154331968.png",alt:"image-20230806154331968"}})]),s._v(" "),n("p",[s._v("下面我们进行检索验证，因为上面咱们创建的索引中，文本内容是保存到"),n("code",[s._v("content")]),s._v("字段中的，所以我们对"),n("code",[s._v("content")]),s._v("字段进行分词检索（"),n("code",[s._v("content")]),s._v("使用的是"),n("code",[s._v("ik分词器")]),s._v("，不是很了解的可以参考之前的文章进行一下安装）")]),s._v(" "),n("p",[s._v("1、首先检索条件是"),n("code",[s._v("内容")]),s._v("，预期结果是返回第一个文档与第三个文档")]),s._v(" "),n("p",[s._v("2、再次检索"),n("code",[s._v("mysql")]),s._v("，返回第一个文档")]),s._v(" "),n("p",[s._v("通过上面两个小例子，可以验证出来的结论就是，我们在文本内容过大需要对内容进行检索时，可以使用提前指定的"),n("code",[s._v("pipeline")]),s._v("进行预处理")]),s._v(" "),n("h1",{attrs:{id:"五、设置读取文本范围"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、设置读取文本范围"}},[s._v("#")]),s._v(" 五、设置读取文本范围")]),s._v(" "),n("p",[s._v("在"),n("strong",[s._v("Elasticsearch")]),s._v("中，"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("插件的"),n("code",[s._v("indexed_chars")]),s._v("参数默认值是"),n("code",[s._v("100000")]),s._v("，表示将文本内容的前"),n("code",[s._v("100000")]),s._v("保存在索引字段中")]),s._v(" "),n("p",[s._v("如果将其设置为"),n("code",[s._v("-1")]),s._v("，"),n("strong",[s._v("Elasticsearch")]),s._v("会保存所有文本内容。"),n("strong",[s._v("这可能会导致索引文档过大，对性能和资源造成影响，特别是当处理大文本时。")])]),s._v(" "),n("p",[s._v("为了避免索引文档过大的问题，我们可以根据实际情况设置"),n("code",[s._v("indexed_chars")]),s._v("参数，将其设置为较小的值，限制保存的字符数。这样可以减小索引文档的大小，降低"),n("strong",[s._v("Elasticsearch")]),s._v("的负担。")]),s._v(" "),n("p",[s._v("假如限制保存的字符数为"),n("code",[s._v("50000")]),s._v("，可以如下设置：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("PUT _ingest/pipeline/attachment\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Pipeline for processing attachments"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"processors"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"attachment"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"field"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"content"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"indexed_chars"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("这样，只有前"),n("code",[s._v("50000")]),s._v("个字符会被保存在"),n("code",[s._v("content")]),s._v("字段中，而超过这个字符数的部分则会被截断，不会保存在索引中。")]),s._v(" "),n("p",[s._v("如果想单独设定某个文档的取值范围，也可以在索引的文档中指定字段值，举例如下")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT _ingest/pipeline/attachment_max\n{\n  "description" : "Extract attachment information",\n  "processors" : [\n    {\n      "attachment" : {\n        "field" : "content",\n        "indexed_chars": 6,\n        "indexed_chars_field" : "max_size",\n      }\n    }\n  ]\n}\nPUT /zfc-doc-000005\n{\n  "mappings": {\n    "properties": {\n      "id":{\n        "type": "keyword"\n      },\n      "title":{\n        "type": "text",\n        "analyzer": "ik_max_word"\n      },\n      "content": {\n        "type": "text",\n        "analyzer": "ik_max_word"\n      }\n    }\n  }\n}\nPOST zfc-doc-000005/_doc?pipeline=attachment_max\n{\n  "id":"10",\n"content":"5Litc2FkZ+eahOmqhOWCsuWIu+W9leacuuWNoea0m+aWr+Wkp+iSnOS7t+agvOWWgOS7gOinieW+l+aWr+WNoeaLiemjkuWNjg==",\n  "max_size":10\n}\nPOST zfc-doc-000005/_doc?pipeline=attachment_max\n{\n  "id":"11",\n  "content":"5Litc2FkZ+eahOmqhOWCsuWIu+W9leacuuWNoea0m+aWr+Wkp+iSnOS7t+agvOWWgOS7gOinieW+l+aWr+WNoeaLiemjkuWNjg=="\n}\nGET zfc-doc-000005/_search\n{\n  "query": {\n    "term": {\n      "id": {\n        "value": "11"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("p",[s._v("使用"),n("code",[s._v('"indexed_chars_field" : "max_size"')]),s._v(",指定文档中的字段，根据文档中的"),n("code",[s._v("max_size")]),s._v("字段来决定要取多少文本索引到字段中，如果文档中没有指定"),n("code",[s._v("max_size")]),s._v("则使用"),n("code",[s._v("pipeline")]),s._v("中指定的"),n("code",[s._v("indexed_chars")]),s._v("大小")]),s._v(" "),n("h1",{attrs:{id:"六、移除二进制源文本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、移除二进制源文本"}},[s._v("#")]),s._v(" 六、移除二进制源文本")]),s._v(" "),n("p",[s._v("除了使用上述指定读取文本文件的指定长度，还可以使用另一个参数"),n("code",[s._v('"remove_binary": true')]),s._v("控制来判断是否保存二进制编码的文本")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT _ingest/pipeline/attachment_max\n{\n  "description" : "Extract attachment information",\n  "processors" : [\n    {\n      "attachment" : {\n        "field" : "content",\n        "remove_binary": true\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("code",[s._v("remove_binary")]),s._v(" 设置为"),n("code",[s._v("true")]),s._v("即不保存原始二进制文本，只会保存解析之后的结果，这种处理方式可以大大的减少存储空间")]),s._v(" "),n("h1",{attrs:{id:"七、优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七、优点"}},[s._v("#")]),s._v(" 七、优点")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("轻量化索引文档：使用"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理文本内容时，只会将文本的元数据（例如文件路径或URL）以及转换后的"),n("strong",[s._v("attachment")]),s._v("类型的内容保存在索引文档中，而不是保存整个文本内容。这样可以显著减小索引文档的大小，节省存储空间，并提高索引和检索的性能。")])]),s._v(" "),n("li",[n("p",[s._v("全文搜索功能：通过"),n("strong",[s._v("Pipeline")]),s._v("中的"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理文本内容后，"),n("strong",[s._v("Elasticsearch")]),s._v("可以支持全文搜索功能，可以对文本进行全文检索，查找包含指定关键词的文档。")])]),s._v(" "),n("li",[n("p",[s._v("灵活的数据处理："),n("strong",[s._v("Pipeline")]),s._v("机制允许在文本内容存储到Elasticsearch之前进行预处理。可以通过"),n("strong",[s._v("Pipeline")]),s._v("添加其他处理器来进行数据转换、清理或提取。")])]),s._v(" "),n("li",[n("p",[s._v("易于维护和扩展：使用"),n("strong",[s._v("Pipeline")]),s._v("可以将数据处理逻辑与索引操作解耦，使代码结构更清晰，易于维护和扩展。如果以后有其他数据处理需求，只需要修改"),n("strong",[s._v("Pipeline")]),s._v("而不需要修改索引操作。")])]),s._v(" "),n("li",[n("p",[s._v("可以实现附件类型：使用"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("可以将文本内容转换为"),n("strong",[s._v("attachment")]),s._v("类型，这是"),n("strong",[s._v("Elasticsearch")]),s._v("内置的一种特殊数据类型，支持对文档内容的索引和全文检索。")])])]),s._v(" "),n("h1",{attrs:{id:"八、缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#八、缺点"}},[s._v("#")]),s._v(" 八、缺点")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("存储需求：虽然使用"),n("strong",[s._v("attachment")]),s._v("类型可以减小索引文档的大小，但是仍然需要在"),n("strong",[s._v("Elasticsearch")]),s._v("中存储文本内容的转换结果。对于大量大文本内容的情况，仍需要较大的存储空间，并且最好使用"),n("code",[s._v('"remove_binary": true')]),s._v("移除二进制文本。")])]),s._v(" "),n("li",[n("p",[s._v("内存消耗：在处理大文本内容时，"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("需要将文本内容暂存到内存中进行处理，因此会消耗较多的内存资源。如果处理大量大文本，可能导致内存压力增加，影响性能。")])]),s._v(" "),n("li",[n("p",[s._v("处理性能：虽然使用"),n("strong",[s._v("Pipeline")]),s._v("可以在索引之前进行预处理，但"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("的处理速度仍然会受到限制。在处理大量大文本内容时，可能导致处理速度较慢，影响索引性能。")])]),s._v(" "),n("li",[n("p",[s._v("不适用于实时场景：由于"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理文本内容需要较多的计算和存储资源，适用于离线或批处理的场景。对于实时索引或对性能要求较高的场景，可能需要考虑其他方案。")])]),s._v(" "),n("li",[n("p",[s._v("不支持所有文件类型：虽然"),n("strong",[s._v("attachment")]),s._v("类型支持多种文件类型，但仍有一些特殊文件类型可能不受支持。在使用"),n("strong",[s._v("Pipeline")]),s._v("中的"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理文本内容时，需要注意文件类型的兼容性。")])]),s._v(" "),n("li",[n("p",[s._v("额外的配置和维护：使用"),n("strong",[s._v("Pipeline")]),s._v("需要额外的配置和维护，需要定义处理器、设置参数等")])]),s._v(" "),n("li",[n("p",[s._v("依赖插件："),n("strong",[s._v("Ingest Attachment Processor")]),s._v("是"),n("strong",[s._v("Elasticsearch")]),s._v("的一个插件，需要确保插件的版本与"),n("strong",[s._v("Elasticsearch")]),s._v("版本兼容")])])]),s._v(" "),n("h1",{attrs:{id:"九、总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#九、总结"}},[s._v("#")]),s._v(" 九、总结")]),s._v(" "),n("p",[s._v("使用"),n("strong",[s._v("Pipeline")]),s._v("中的"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理文本内容可以在不影响检索功能的前提下，优化索引文档的大小，提高索引和检索的性能，并灵活地处理和扩展数据。这是处理大文本内容时的一种高效和可靠的方式。虽然"),n("strong",[s._v("Pipeline")]),s._v("中的"),n("strong",[s._v("Ingest Attachment Processor")]),s._v("处理大文本内容是一种高效和灵活的方式，但仍然存在一些挑战和限制。在实际使用中，需要综合考虑实际需求、资源限制和性能要求，选择合适的处理方案。如果处理大量大文本或对性能要求较高，可能需要考虑其他优化措施或方案。")]),s._v(" "),n("h1",{attrs:{id:"十、需要注意的点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十、需要注意的点"}},[s._v("#")]),s._v(" 十、需要注意的点")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("索引性能：处理大文本时，"),n("strong",[s._v("Pipeline")]),s._v("的执行可能会占用较多的CPU和内存资源，特别是在处理多个大文本时。这可能会对"),n("strong",[s._v("Elasticsearch")]),s._v("的索引性能和整体系统性能造成影响。在处理大文本之前，建议评估系统的性能和资源利用情况，确保系统有足够的资源来执行处理。")])]),s._v(" "),n("li",[n("p",[s._v("超时设置："),n("strong",[s._v("Pipeline")]),s._v("的执行可能需要一定的时间，尤其是在处理大文本时。如果"),n("strong",[s._v("Pipeline")]),s._v("的执行时间超过了"),n("strong",[s._v("Elasticsearch")]),s._v("的默认超时设置，可能会导致任务失败。你可以通过设置"),n("code",[s._v("timeout")]),s._v("参数来延长超时时间，确保"),n("strong",[s._v("Pipeline")]),s._v("有足够的时间来执行。")])]),s._v(" "),n("li",[n("p",[s._v("错误处理：在"),n("strong",[s._v("Pipeline")]),s._v("的处理过程中，可能会出现各种错误，例如文本解析错误、索引失败等。你需要注意适当处理这些错误，以避免任务失败导致整个操作中断。可以使用适当的异常处理机制，或者使用"),n("strong",[s._v("Elasticsearch")]),s._v("的"),n("strong",[s._v("Bulk API")]),s._v("来进行批量索引，确保部分文档处理失败时，不会影响其他文档的索引。")])]),s._v(" "),n("li",[n("p",[s._v("内存管理：处理大文本时，可能会产生较大的临时数据，需要注意内存的管理和及时释放。确保处理过程中不会产生内存泄漏或内存溢出问题。")])]),s._v(" "),n("li",[n("p",[s._v("文件路径安全性：如果使用文件路径来索引文本内容，需要注意文件路径的安全性。确保文件路径是合法的、可信的，并限制访问范围，避免可能的安全风险。")])]),s._v(" "),n("li",[n("p",[s._v("版本兼容性：使用"),n("strong",[s._v("Pipeline")]),s._v("时，需要注意插件的版本与Elasticsearch的版本兼容性。确保使用的"),n("strong",[s._v("Pipeline")]),s._v("插件与"),n("strong",[s._v("Elasticsearch")]),s._v("版本兼容，并定期升级插件以保持稳定性和安全性。")])])]),s._v(" "),n("p",[s._v("总的来说，处理大文本时，需要综合考虑性能、资源利用、错误处理等方面的问题，合理设计和优化Pipeline的处理过程。在实际应用中，可以进行压力测试和性能测试，找到最合适的处理方案，确保系统能够稳定高效地处理大文本内容。")]),s._v(" "),n("h1",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),n("p",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/8.9/attachment.html")])])}),[],!1,null,null,null);n.default=e.exports}}]);