(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{452:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("首先还是说一下背景，工作中用到了 "),n("strong",[s._v("elasticsearch")]),s._v(" 的检索以及高亮展示，但是索引中的"),n("code",[s._v("content")]),s._v("字段是读取的大文本内容，所以后果就是索引的单个字段很大，造成单独检索请求的时候速度还可以，但是加入高亮之后检索请求的耗时就非常的慢了。所以本文从"),n("strong",[s._v("更换高亮器类型")]),s._v("的角度来解决因为高亮造成的检索请求缓慢的问题。")]),s._v(" "),n("h1",{attrs:{id:"es的抵消策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es的抵消策略"}},[s._v("#")]),s._v(" ES的抵消策略")]),s._v(" "),n("p",[s._v("在文章开始前先简单介绍一个"),n("strong",[s._v("elasticsearch")]),s._v("的策略，为了在检索的字段中创建出一个有意义的高亮片段，高亮器会使用原始文本的开始和结束字符串的偏移量，偏移量的获取可以从一下方式获得")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("postings list")]),s._v("：如果在"),n("code",[s._v("mapping")]),s._v("中"),n("code",[s._v("index_options")]),s._v("设置为"),n("code",[s._v("offsets")]),s._v("，"),n("code",[s._v("unified")]),s._v("高亮器使用此信息高亮显示文档而不用再次分析文本。")]),s._v(" "),n("li",[n("code",[s._v("term vectors")]),s._v("：如果我们在"),n("code",[s._v("mapping")]),s._v("中设置"),n("code",[s._v("term_vector")]),s._v("为"),n("code",[s._v("with_positions_offsets")]),s._v("，则"),n("code",[s._v("unified")]),s._v("高亮器会自动使用"),n("code",[s._v("term_vector")]),s._v("来高亮显示，对于大于"),n("code",[s._v("1M")]),s._v("的大字段，使用"),n("code",[s._v("term_vector")]),s._v("速度会很快，"),n("code",[s._v("fvh")]),s._v("高亮器就是使用的"),n("code",[s._v("term_vector")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("plain highlighting")]),s._v("：当"),n("code",[s._v("unified")]),s._v("没有其他的选择的时候会使用"),n("code",[s._v("plain")]),s._v("模式，它会创建了一个微小的内存索引，并通过"),n("strong",[s._v("Lucene")]),s._v("的查询执行计划器重新运行原始查询条件。"),n("code",[s._v("plain")]),s._v("高亮器默认使用的就是此模式")])]),s._v(" "),n("blockquote",[n("p",[s._v("大文本的纯高亮展示可能需要大量的时间和内存，为了防止这种情况，es默认将大文本的字符数量限制为"),n("code",[s._v("1000000")]),s._v("，可以使用"),n("code",[s._v("index.highlight.max_analyzed_offset")]),s._v("修改此默认设置")])]),s._v(" "),n("h1",{attrs:{id:"一、fvh高亮器简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、fvh高亮器简介"}},[s._v("#")]),s._v(" 一、FVH高亮器简介")]),s._v(" "),n("p",[s._v("FVH（"),n("strong",[s._v("Fast Vector Highlighter")]),s._v("）是"),n("strong",[s._v("Elasticsearch")]),s._v("高亮器中的一种算法，使用的是"),n("strong",[s._v("Lucene Fast Vector highlighter")]),s._v("，它能够快速而准确地在文本中找到匹配的关键词，并将其标记为高亮。相比于其他高亮器算法，FVH在性能上有着显著的优势，特别适用于大规模数据集和高并发的场景。")]),s._v(" "),n("h1",{attrs:{id:"二、fvh高亮器的使用方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、fvh高亮器的使用方法"}},[s._v("#")]),s._v(" 二、FVH高亮器的使用方法")]),s._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("p",[s._v("首先，确保已经正确安装了 "),n("strong",[s._v("Elasticsearch")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('version: \'3.8\'\nservices:\n  cerebro:\n    image: lmenezes/cerebro:0.8.3\n    container_name: cerebro\n    ports:\n     - "9000:9000"\n    command:\n     - -Dhosts.0.host=http://eshot:9200\n    networks:\n     - elastic\n  kibana:\n    image: docker.elastic.co/kibana/kibana:8.1.3\n    container_name: kibana\n    environment:\n      - I18N_LOCALE=zh-CN\n      - XPACK_GRAPH_ENABLED=true\n      - TIMELION_ENABLED=true\n      - XPACK_MONITORING_COLLECTION_ENABLED="true"\n      - ELASTICSEARCH_HOSTS=http://eshot:9200\n      - server.publicBaseUrl=http://192.168.160.234:5601\n    ports:\n      - "5601:5601"\n    networks:\n      - elastic\n  eshot:\n    image: elasticsearch:8.1.3\n    container_name: eshot\n    environment:\n      - node.name=eshot\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=hot\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    ports:\n      - 9200:9200\n    networks:\n      - elastic\n  eswarm:\n    image: elasticsearch:8.1.3\n    container_name: eswarm\n    environment:\n      - node.name=eswarm\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=warm\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\eswarm\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n  escold:\n    image: elasticsearch:8.1.3\n    container_name: escold\n    environment:\n      - node.name=escold\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=eshot,eswarm,escold\n      - cluster.initial_master_nodes=eshot,eswarm,escold\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"\n      - xpack.security.enabled=false\n      - node.attr.node_type=cold\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    volumes:\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\data:/usr/share/elasticsearch/data\n      - D:\\zuiyuftp\\docker\\es8.1\\escold\\logs:/usr/share/elasticsearch/logs\n      - D:\\zuiyuftp\\docker\\es8.1\\eshot\\plugins:/usr/share/elasticsearch/plugins\n    networks:\n      - elastic\n\n# volumes:\n#   eshotdata:\n#     driver: local\n#   eswarmdata:\n#     driver: local\n#   escolddata:\n#     driver: local\n\nnetworks:\n  elastic:\n    driver: bridge\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br")])]),n("h2",{attrs:{id:"创建索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建索引"}},[s._v("#")]),s._v(" 创建索引")]),s._v(" "),n("p",[s._v("在使用FVH高亮器之前，需要先创建一个索引，并将需要高亮的字段进行映射。例如，我们要在"),n("code",[s._v("content")]),s._v("字段中进行高亮，可以使用以下代码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /example_target\n{\n  "mappings": {\n    "properties": {\n      "content": {\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "term_vector": "with_positions_offsets"\n      },\n      "title": {\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "term_vector": "with_positions_offsets"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"添加测试数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加测试数据"}},[s._v("#")]),s._v(" 添加测试数据")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST example_target/_doc\n{\n  "content":"中华人民共和国是否考虑是否就爱上速度加快分解ask计算机卡死撒中华上的飞机拉丝机是的地方记录 卡就是开发建设看积分卡说了句 ask就疯狂萨拉丁就发士大 sdf 看得见啊李开复 圣诞节卡了 夫哈数据库中华啊，中华，人民爱上中华",\n  "title":"中华人名共和国"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"查询并高亮"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询并高亮"}},[s._v("#")]),s._v(" 查询并高亮")]),s._v(" "),n("p",[s._v("使用FVH高亮器进行查询和高亮的过程如下所示：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET example_target/_search\n{\n  "query": {\n    "match": {\n      "content": "中华 爱上"\n    }\n  },\n  "highlight": {\n    "pre_tags": "<em>",\n    "post_tags": "</em>", \n    "require_field_match": "false", \n    "fields": {\n      "content": {\n         "type": "fvh",\n        "fragment_size": 18,\n        "number_of_fragments": 3\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("以上代码中，我们通过"),n("code",[s._v("match")]),s._v("查询找到了包含关键词的文档，然后在"),n("code",[s._v("highlight")]),s._v("内容中指定了需要高亮的字段，这里是"),n("code",[s._v("content")]),s._v("。执行述查询后，Elasticsearch将返回匹配的结果，并在"),n("code",[s._v("content")]),s._v("字段中添加了高亮标记。")]),s._v(" "),n("blockquote",[n("p",[s._v("数据量少的时候对比不是特别明显，所以在测试时，可以在索引中添加大量的测试数据进行测试，本人在测试过程中es的索引大小在"),n("code",[s._v("500M")]),s._v("左右，单个字段纯文本大小也有"),n("code",[s._v("1-2M")]),s._v("。此时这种数据规模下使用普通的高亮器在检索请求时就已经非常缓慢了，根据返回的数据量多少来决定，在取"),n("code",[s._v("10")]),s._v("条数据时已经能达到"),n("code",[s._v("6")]),s._v("秒了，但是在使用"),n("code",[s._v("fvh")]),s._v("高亮器之后时间已经进入毫秒级")])]),s._v(" "),n("h1",{attrs:{id:"三、fvh高亮器的参数配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、fvh高亮器的参数配置"}},[s._v("#")]),s._v(" 三、FVH高亮器的参数配置")]),s._v(" "),n("p",[s._v("先看一下返回的数据结果在对照下面参数学习")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "took" : 4,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 3,\n      "relation" : "eq"\n    },\n    "max_score" : 0.41193593,\n    "hits" : [\n      {\n        "_index" : "example_target",\n        "_id" : "f1rkC4oBCDmhQc2yo6PQ",\n        "_score" : 0.41193593,\n        "_source" : {\n          "content" : "中华人民共和国是否考虑是否就爱上速度加快分解ask计算机卡死撒中华上的飞机拉丝机是的地方记录 卡就是开发建设看积分卡说了句 ask就疯狂萨拉丁就发士大 sdf 看得见啊李开复 圣诞节卡了 夫哈数据库中华啊，中华，人民爱上中华"\n        },\n        "highlight" : {\n          "content" : [\n            "&lt;em>中华&lt;/em>人民共和国是否考虑是否就&lt;em>爱上&lt;/em>速度",\n            "sk计算机卡死撒&lt;em>中华&lt;/em>上的飞机拉丝机是的地方记录",\n            "夫哈数据库&lt;em>中华&lt;/em>啊，&lt;em>中华&lt;/em>，人民&lt;em>爱上&lt;/em>中华"\n          ]\n        }\n      },\n      {\n        "_index" : "example_target",\n        "_id" : "G3Fi44kB4IVEhjafHXOf",\n        "_score" : 0.33311102,\n        "_source" : {\n          "content" : "中华人民共和国是否考虑是否就爱上速度加快分解ask计算机卡死撒中华上的飞机拉丝机是的地方记录卡就是开发建设看积分卡说了句ask就疯狂萨拉丁就发士大夫哈数据库"\n        },\n        "highlight" : {\n          "content" : [\n            "&lt;em>中华&lt;/em>人民共和国是否考虑是否就&lt;em>爱上&lt;/em>速度",\n            "sk计算机卡死撒&lt;em>中华&lt;/em>上的飞机拉丝机是"\n          ]\n        }\n      },\n      {\n        "_index" : "example_target",\n        "_id" : "HHFt44kB4IVEhjafE3Ov",\n        "_score" : 0.31932122,\n        "_source" : {\n          "content" : "中华人民共和国是否考虑是否就爱上速度加快分解ask计算机卡死撒中华上的飞机拉丝机是的地方记录 卡就是开发建设看积分卡说了句 ask就疯狂萨拉丁就发士大 sdf 看得见啊李开复 圣诞节卡了 夫哈数据库"\n        },\n        "highlight" : {\n          "content" : [\n            "&lt;em>中华&lt;/em>人民共和国是否考虑是否就&lt;em>爱上&lt;/em>速度",\n            "sk计算机卡死撒&lt;em>中华&lt;/em>上的飞机拉丝机是的地方记录"\n          ]\n        }\n      }\n    ]\n  }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("p",[s._v("通过上面的查询请求中高亮参数的指定可以发现，高亮器还是支持其他的参数的，那么我们下面将对几个常用的参数进行说明")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("fragment_size")]),s._v("：指定每个高亮片段的长度，默认为"),n("code",[s._v("100")]),s._v("个字符。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("number_of_fragments")]),s._v("：指定返回的高亮片段数量，默认为"),n("code",[s._v("5")]),s._v("个。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("pre_tags")]),s._v("和"),n("code",[s._v("post_tags")]),s._v("：分别指定高亮标记的前缀和后缀，默认为"),n("code",[s._v("<em>")]),s._v("和"),n("code",[s._v("</em>")]),s._v("。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("require_field_match")]),s._v("：指定是否要求所有字段都匹配关键词才进行高亮，默认为"),n("code",[s._v("true")]),s._v("。可以开启关闭此参数对上面的"),n("code",[s._v("title")]),s._v("字段进行校验")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("type")]),s._v("：指定"),n("code",[s._v("fvh")]),s._v("高亮器，除了"),n("code",[s._v("fvh")]),s._v("之外还有"),n("code",[s._v("unified")]),s._v("，"),n("code",[s._v("plain")]),s._v("。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("unified")]),s._v(" 是默认的高亮器，可以将文本分解为句子，并使用BM25算法对单个句子进行评分，还支持精确的短语高亮显示，支持（"),n("code",[s._v("fuzzy")]),s._v("，"),n("code",[s._v("prefix")]),s._v("，"),n("code",[s._v("regex")]),s._v("）高亮。")]),s._v(" "),n("li",[n("code",[s._v("plain")]),s._v(" 普通的高亮器，适用与简单的查询或者单个字段的匹配。为了准确的反应查询逻辑，它会在内存中创建一个很小的索引，来对原始的查询语句进行执行，来访问当前更低级别的匹配信息。")])])])]),s._v(" "),n("p",[s._v("在使用"),n("code",[s._v("FVH")]),s._v("高亮器时，根据实际需求，可以灵活地调整这些参数，以获得最佳的高亮效果。")]),s._v(" "),n("h1",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("通过本文的介绍，我们了解了Elasticsearch高亮器中的"),n("code",[s._v("FVH")]),s._v("算法，并学会了如何使用它为搜索结果增添亮点。"),n("code",[s._v("FVH")]),s._v("高亮器在性能和功能上都有着明显的优势，对于大规模数据集和高并发的场景尤为适用。希望读者通过本文的指引，能够更好地利用"),n("code",[s._v("FVH")]),s._v("高亮器来提升搜索结果的可读性和用户体验。")]),s._v(" "),n("h1",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),n("p",[s._v("https://www.elastic.co/guide/en/elasticsearch/reference/8.1/highlighting.html")])])}),[],!1,null,null,null);n.default=t.exports}}]);